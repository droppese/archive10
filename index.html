<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚˜ëˆ”ì˜ ìˆ²</title> 
    
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa; 
            margin: 0;
            padding: 20px; 
            line-height: 1.6;
            /* í‘¸í„°ê°€ ìˆ¨ê²¨ì§€ë¯€ë¡œ í•˜ë‹¨ ì—¬ë°± ì¶•ì†Œ */
            padding-bottom: 20px; 
        }

        .container {
            max-width: 1000px; 
            margin: auto;
            background: #ffffff; 
            padding: 25px;
            border-radius: 12px; 
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1); 
            position: relative;
            min-height: auto; 
        }

        h1 {
            color: #34495e; 
            padding-bottom: 15px; 
            margin-bottom: 20px; 
            font-size: 1.8em; 
            font-weight: 600;
            position: relative; 
            /* ì œëª© í´ë¦­ ì˜ì—­ì— ë§ˆìš°ìŠ¤ ì˜¤ë²„ íš¨ê³¼ (íŒíŠ¸ ì œê³µ) */
            cursor: pointer;
            transition: opacity 0.2s;
        }
        
        h1:hover {
            opacity: 0.85;
        }

        h1::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0; 
            width: 100%;
            height: 8px; 
            background: repeating-linear-gradient(
                45deg,
                #8bc34a, 
                #8bc34a 4px, 
                #689f38 4px, 
                #689f38 8px 
            );
            border-radius: 0 0 4px 4px; 
        }
        
        /* --- ê²€ìƒ‰ì°½ ìŠ¤íƒ€ì¼ --- */
        .search-box {
            position: relative;
            width: 100%;
            margin-bottom: 20px;
        }

        #searchInput {
            width: 100%;
            /* ğŸ” ì•„ì´ì½˜ ë° X ë²„íŠ¼ ê³µê°„ í™•ë³´ë¥¼ ìœ„í•´ íŒ¨ë”© ì¡°ì • */
            padding: 10px 35px 10px 35px; 
            box-sizing: border-box; 
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 0.95em;
        }

        .search-icon {
            position: absolute;
            left: 10px; 
            top: 50%;
            transform: translateY(-50%);
            color: #95a5a6; 
            pointer-events: none; 
            font-size: 1.2em;
        }
        
        /* ì§€ìš°ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        #clearSearchBtn {
            position: absolute;
            right: 10px; 
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #7f8c8d; 
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            padding: 0;
            line-height: 1;
            display: none; 
            z-index: 10;
        }

        #clearSearchBtn:hover {
            color: #34495e;
        }
        
        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        footer button, .form-actions button, #mainContent .action-group button { 
            background-color: #e9ecef; 
            color: #34495e;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            margin-left: 5px; 
            font-size: 0.9em; 
            transition: all 0.2s;
            white-space: nowrap;
        }

        footer button:hover, .form-actions button:hover, #mainContent .action-group button:hover {
            background-color: #dee2e6;
        }
        
        .status-message.buyer { color: #3498db; font-weight: 600; }

        /* ë“±ë¡ ë° ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
        #buttonContainer {
            margin: 15px 0;
            text-align: right;
            display: flex;
            justify-content: flex-end;
            gap: 10px; 
        }
        
        .action-group {
            display: flex;
            gap: 5px;
        }

        /* ë“±ë¡ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        #registerButtonContainer button {
            background-color: #27ae60; 
            color: white;
            padding: 10px 15px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(39, 174, 96, 0.3);
            margin-left: 0; 
        }
        
        #registerButtonContainer button:hover {
            background-color: #2ecc71;
        }
        
        /* ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        #categoryButton {
            background-color: #f39c12; 
            color: white;
            padding: 10px 15px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(243, 156, 18, 0.3);
            margin-left: 0;
        }
        
        #categoryButton:hover {
            background-color: #f1c40f;
        }

        /* --- ì•„ì´í…œ ë¦¬ìŠ¤íŠ¸ (ê³µí†µ ì¹´ë“œ êµ¬ì¡°) ìŠ¤íƒ€ì¼ --- */
        
        .list-container {
            display: flex;
            flex-direction: column;
            gap: 15px; 
            margin-top: 15px;
        }
        
        #adminListPage .list-container {
             margin-top: 25px;
             border: 2px solid #e74c3c; 
             border-radius: 10px;
             padding: 15px;
             background-color: #fef5f4; 
        }

        /* ê°œë³„ ì•„ì´í…œ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .item-card {
            display: flex; 
            align-items: flex-start; 
            padding: 15px;
            border: 1px solid #ecf0f1;
            border-radius: 8px;
            background-color: #ffffff;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            cursor: pointer;
            transition: background-color 0.2s;
            position: relative;
        }

        .item-card:hover {
            background-color: #f5f5f5;
        }

        /* ì¸ë„¤ì¼ Wrapper: í¬ê¸° ê³ ì • ë° í…ìŠ¤íŠ¸ ë°€ë¦¼ ë°©ì§€ */
        .item-thumbnail-wrapper {
            width: 60px; 
            height: 60px; 
            min-width: 60px; 
            border-radius: 8px;
            overflow: hidden;
            margin-right: 15px;
            border: 1px solid #bdc3c7;
            flex-shrink: 0; 
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #ecf0f1;
            font-size: 0.7em;
            color: #7f8c8d;
        }
        
        .item-thumbnail {
            width: 100%;
            height: 100%;
            object-fit: cover; 
            border-radius: 8px;
            border: none; 
        }

        /* í…ìŠ¤íŠ¸ ì»¨í…ì¸  ì˜ì—­ */
        .item-content {
            flex-grow: 1;
            min-width: 0; 
        }
        
        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 5px;
        }
        
        /* ê´€ë¦¬ì ëª©ë¡: ì´ë¦„ê³¼ ìƒíƒœë¥¼ ì„¸ë¡œë¡œ ë°°ì¹˜í•˜ê¸° ìœ„í•œ ì¡°ì • */
        .admin-card .item-header {
            display: block; 
            margin-bottom: 0;
        }
        .admin-card .item-name {
            display: block; 
            margin-right: 0;
            margin-bottom: 5px; 
            white-space: normal; 
            overflow: visible; 
            text-overflow: clip;
        }
        .admin-card .item-status {
             display: block; 
             margin-bottom: 5px;
        }

        /* ë¶€ì„œ ë¶ˆì¼ì¹˜ ì‹œ ìƒíƒœ ìŠ¤íƒ€ì¼ */
        .admin-card .unauthorized {
            color: #e74c3c;
            font-weight: 500;
        }


        .item-name {
            font-weight: 700;
            color: #34495e;
            font-size: 1.1em;
            max-width: 70%; 
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap; 
            margin-right: 10px;
        }

        /* ì•„ì´í…œ ìƒíƒœ ë° ê¸°íƒ€ ì •ë³´ */
        .item-info {
            font-size: 0.85em;
            color: #7f8c8d;
            margin-bottom: 5px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .item-actions {
            margin-top: 8px;
            display: flex;
            flex-wrap: wrap; 
            gap: 5px; 
            font-size: 0.9em; 
            font-weight: bold;
        }

        /* ë””í…Œì¼ ë‚´ìš© */
        .detail-row {
            display: none;
            width: 100%;
            background-color: #ecf0f1; 
            padding: 15px;
            border-radius: 8px;
            margin-top: -10px; 
            border: 1px dashed #ccc;
            border-top: none; 
            box-sizing: border-box;
        }

        /* ìƒì„¸ ì´ë¯¸ì§€ ì˜ì—­ ìŠ¤íƒ€ì¼ ì¡°ì • */
        .detail-image-box {
            text-align: center;
            margin: 10px auto 15px auto;
            max-width: 100%; 
            height: auto;
            border-radius: 8px;
            border: 1px solid #ccc;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            background-color: #ecf0f1;
            display: block;
            padding: 0;
            overflow: hidden;
        }

        /* ì´ë¯¸ì§€ ìì²´ì— ì ìš©í•˜ì—¬ ìµœëŒ€ ë„ˆë¹„ ë³´ì¥ */
        .detail-image-box img {
            max-width: 100%; 
            height: auto; 
            display: block;
        }
        
        .detail-image-box.no-image {
            width: 100%;
            max-width: 250px;
            height: 150px; 
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1em;
            color: #7f8c8d;
            font-weight: bold;
        }

        /* ì•¡ì…˜ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .admin-action-btn, .action-btn {
            padding: 8px 12px;
            margin: 0; 
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
            font-weight: 500;
        }
        
        .trade-apply-btn { background-color: #3498db; color: white; } 
        .approve-btn { background-color: #2ecc71; color: white; } 
        .approve-trade-btn { background-color: #1abc9c; color: white; } 
        .confirm-trade-btn { background-color: #9b59b6; color: white; } 
        .cancel-trade-btn { background-color: #e74c3c; color: white; } 
        .edit-btn { background-color: #f1c40f; color: #333; } 
        .delete-btn { background-color: #bdc3c7; color: #333; }
        
        /* ë¹„í™œì„±í™” ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .disabled-btn {
            background-color: #cccccc !important;
            color: #666666 !important;
            cursor: not-allowed !important;
            pointer-events: none;
            opacity: 0.6;
        }

        .cancel-btn { 
            background-color: #bdc3c7; 
            color: #333;
        }
        
        .cancel-btn:hover { background-color: #95a5a6; }

        .detail-content {
            padding: 15px;
            font-size: 0.9em; 
            color: #555;
        }
        
        /* ê´€ë¦¬ì ëª©ë¡ê³¼ êµ¬ë§¤ì ë‚´ì—­ ì „ìš© ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .admin-card {
            background-color: #fff8f8; 
        }
        .history-card {
            background-color: #f9fcff; 
            cursor: default; 
        }
        .history-card:hover {
            background-color: #f9fcff;
        }
        
        .admin-info {
            font-size: 0.8em;
            color: #7f8c8d;
            margin-top: 5px;
        }

        /* í‘¸í„° ìŠ¤íƒ€ì¼ (ìˆ˜ì •ë¨: í•˜ë‹¨ ê³ ì •, ê¸°ë³¸ ìˆ¨ê¹€) */
        footer {
            position: fixed; 
            bottom: 0;
            left: 0;
            right: 0;
            width: 100%; 
            z-index: 1000; 
            
            max-width: 100%; 
            margin: 0; 
            padding: 15px 0; 
            text-align: center;
            border-top: 1px solid #ecf0f1;
            background-color: #FFD54F; /* ê°œë‚˜ë¦¬ìƒ‰ ê³„ì—´ë¡œ ë³€ê²½ */
            color: #34495e;
            border-radius: 0; 
            box-shadow: 0 -4px 8px rgba(0,0,0,0.2); 
            
            /* ê¸°ë³¸ ìˆ¨ê¹€ ì²˜ë¦¬ */
            display: none; 
            
            justify-content: center;
            align-items: center;
            gap: 15px; 
            cursor: pointer;
            box-sizing: border-box; 
        }
        
        footer button {
            margin: 0; 
            font-size: 0.9em;
        }

        /* ê´€ë¦¬ ëª©ë¡ ë²„íŠ¼ ë””ìì¸ */
        footer #adminListBtn { 
            background-color: #c099e8; 
            color: white;
            padding: 10px 18px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(192, 153, 232, 0.4);
        }
        
        footer #adminListBtn:hover {
            background-color: #a87ed1;
        }

        /* ë™ì  ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        footer #dynamicLogoutBtn {
            background-color: #92b0e8; 
            color: white;
            padding: 10px 18px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(146, 176, 232, 0.4);
            transition: all 0.2s; 
        }
        
        footer #dynamicLogoutBtn:hover {
            background-color: #7a9fd2;
        }
        
        /* ì•„ì´í…œ ë“±ë¡ í¼ ìŠ¤íƒ€ì¼ */
        #registrationFormPage, #itemDetailPage {
            padding: 20px;
            border: 1px solid #3498db;
            border-radius: 10px;
            background-color: #f9fcff;
        }

        #registrationFormPage h3, #itemDetailPage h3 {
            color: #34495e;
            border-bottom: 2px solid #bdc3c7;
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-size: 1.3em;
        }
        
        /* í¼ ìš”ì†Œ ê³µí†µ ìŠ¤íƒ€ì¼ */
        .form-content input[type="text"], .form-content select, .form-content textarea {
            width: 100%;
            padding: 10px;
            box-sizing: border-box; 
            border: 1px solid #ccc;
            border-radius: 6px;
            margin-bottom: 10px;
            font-size: 0.95em;
        }
        
        /* ë“±ë¡ì/ì‹ ì²­ì ì •ë³´ ì…ë ¥ë€ ê·¸ë£¹í™” */
        .info-group {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 10px;
            padding: 15px;
            border: 1px dashed #3498db;
            border-radius: 8px;
            background-color: #eef7ff; 
        }

        .form-label {
            display: block;
            font-size: 0.9em;
            color: #555;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        #itemImageFile {
            border: none;
            padding: 10px 0;
        }

        #itemDescription, #applyDescription {
            height: 120px; 
            resize: vertical;
        }

        .form-actions {
            margin-top: 20px;
        }
        
        /* ì¹´í…Œê³ ë¦¬ í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
        #categoryPage {
            padding: 20px;
        }
        
        .category-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr); 
            gap: 20px;
            margin-top: 20px;
        }
        
        .category-item {
            display: flex;
            flex-direction: column; 
            align-items: center;
            justify-content: center;
            height: 100px;
            background-color: #ecf0f1;
            border-radius: 10px;
            font-weight: bold;
            color: #34495e;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
            font-size: 1.1em;
            text-align: center;
        }

        /* ì•„ì´ì½˜ ì „ìš© ìŠ¤íƒ€ì¼ */
        .category-icon {
            font-size: 2em; 
            margin-bottom: 5px;
            line-height: 1; 
        }
        
        .category-item:hover {
            background-color: #bdc3c7;
            border-color: #3498db;
        }

        /* ì•„ì´í…œ ìƒíƒœë³„ ìƒ‰ìƒ */
        .status-waiting { color: #f39c12; font-weight: bold; } 
        .status-selling { color: #27ae60; font-weight: bold; } 
        .status-reserved { color: #8e44ad; font-weight: bold; } 
        .status-completed { color: #95a5a6; } 
        .status-cancelled { color: #e74c3c; font-weight: bold; } 
        
        /* --- ë¬¼í’ˆ ìƒì„¸ ë° ì‹ ì²­ í˜ì´ì§€ ìŠ¤íƒ€ì¼ --- */
        #itemDetailPage .item-detail-info {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        
        #itemDetailPage .image-container {
            flex-shrink: 0;
            width: 300px; 
            max-width: 40%;
            height: auto;
            border: 1px solid #ccc;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        #itemDetailPage .image-container img {
            width: 100%;
            height: auto;
            display: block;
        }
        
        #itemDetailPage .image-container.no-image-detail {
            height: 250px;
            background-color: #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1em;
            color: #666;
            font-weight: bold;
        }

        #itemDetailPage .text-content {
            flex-grow: 1;
        }
        
        #itemDetailPage .text-content h2 {
            font-size: 1.6em;
            color: #34495e;
            margin-top: 0;
            margin-bottom: 10px;
        }
        
        #itemDetailPage .text-content p {
            font-size: 1em;
            color: #555;
            margin-bottom: 20px;
            white-space: pre-wrap;
        }
        
        #itemDetailPage .text-content strong {
            color: #3498db;
            display: block;
            margin-top: 10px;
        }
        
        #itemDetailPage .application-form-section {
            padding: 20px;
            border: 2px solid #27ae60;
            border-radius: 10px;
            background-color: #f0fff0;
        }
        
        #itemDetailPage .application-form-section h4 {
            color: #27ae60;
            margin-top: 0;
            border-bottom: 1px dashed #2ecc71;
            padding-bottom: 10px;
        }

        /* --- ëª¨ë°”ì¼ ìµœì í™” --- */
        @media (max-width: 600px) {
            
            body { 
                padding: 10px 5px; 
                /* ëª¨ë°”ì¼ì—ì„œë„ í‘¸í„° ê¸°ë³¸ ìˆ¨ê¹€ */
                padding-bottom: 10px; 
            }
            .container { padding: 15px; }
            
            #buttonContainer {
                flex-direction: column; 
                align-items: stretch;
                gap: 10px;
            }
            
            .action-group {
                gap: 10px;
                justify-content: space-between;
                width: 100%;
            }
            
            #registerButtonContainer button, #categoryButton {
                flex-grow: 1;
                margin-left: 0;
            }

            .item-card {
                flex-direction: row; 
                align-items: center; 
            }

            .item-actions {
                margin-top: 0;
                text-align: left; 
            }
            
            .action-btn {
                padding: 6px 8px;
                font-size: 0.75em;
                display: inline-block; 
                margin: 0 4px 0 0;
            }
            
            .category-grid {
                grid-template-columns: repeat(2, 1fr); 
                gap: 15px;
            }

            .info-group {
                grid-template-columns: 1fr; 
            }
            
            .category-item {
                height: 80px;
                font-size: 1em;
            }

            .category-icon {
                font-size: 1.5em; 
            }

            /* ìƒì„¸ í˜ì´ì§€ ëª¨ë°”ì¼ ì¡°ì • */
            #itemDetailPage .item-detail-info {
                flex-direction: column;
            }
            #itemDetailPage .image-container {
                max-width: 100%;
                width: 100%; 
            }
            
            /* ëª¨ë°”ì¼ í‘¸í„° ë²„íŠ¼ ì •ë ¬ ê°•í™” */
            footer {
                flex-direction: row; 
                flex-wrap: wrap; 
                justify-content: center;
                gap: 10px; 
            }
        }
        
    </style>
</head>
<body>
    <div class="container">
        <h1 id="headerTitle">ğŸŒ³ ë‚˜ëˆ”ì˜ ìˆ²</h1>
        
        <div id="mainContent">
            
            <div class="search-container">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="ë¬¼í’ˆ ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰...">
                    <span class="search-icon">ğŸ”</span>
                    <button id="clearSearchBtn" onclick="clearSearchInput()">X</button>
                </div>
            </div>
            
            <div id="buttonContainer">
                <div class="action-group">
                    <button id="categoryButton" onclick="showPage('categoryPage')">ğŸ·ï¸ ì¹´í…Œê³ ë¦¬</button>
                </div>
                <div id="registerButtonContainer" class="action-group">
                    <button onclick="showPage('registrationFormPage')">ğŸ“¦ ë¬¼í’ˆ ë“±ë¡ ìš”ì²­</button>
                </div>
            </div>
            
            <div id="currentCategoryDisplay" style="margin-bottom: 15px; font-weight: bold; display: none;">
                í˜„ì¬ ì¹´í…Œê³ ë¦¬: <span id="selectedCategoryName" style="color:#3498db;"></span>
                <button onclick="filterByCategory(null)" style="margin-left: 10px; padding: 5px 10px; font-size: 0.8em;">ì´ˆê¸°í™”</button>
            </div>
            
            <div id="item-list-container" class="list-container">
                </div>
            
        </div>
        
        <div id="categoryPage" style="display: none;">
            <h2>ğŸ·ï¸ ì¹´í…Œê³ ë¦¬ ì„ íƒ</h2>
            <p>ì›í•˜ëŠ” ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì—¬ í•´ë‹¹ ë¬¼í’ˆë§Œ í™•ì¸í•˜ì„¸ìš”.</p>
            
            <button class="cancel-btn" onclick="showPage('main')" style="width: auto; margin-bottom: 20px;">ğŸ”™ ë’¤ë¡œê°€ê¸°</button>

            <div class="category-grid">
                </div>
        </div>

        <div id="itemDetailPage" style="display: none;">
            </div>

        <div id="adminListPage" style="display: none;">
            <h2>ğŸš¨ ê´€ë¦¬ ëª©ë¡</h2>
            <p>ì‹ ê·œ ë“±ë¡ ìŠ¹ì¸, ë‚˜ëˆ” ì‹ ì²­ ìŠ¹ì¸, ê±°ë˜ í™•ì • ê´€ë¦¬ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.</p>
            <p style="color:#e74c3c; font-weight:bold;">âœ… í˜„ì¬ ê´€ë¦¬ì ë¶€ì„œ: <span id="currentAdminDept">ë¡œê·¸ì•„ì›ƒ ìƒíƒœ</span></p>
            
            <button class="cancel-btn" onclick="showPage('main')" style="width: auto; margin-bottom: 20px;">ğŸ”™ ë’¤ë¡œê°€ê¸°</button>

            <div id="adminListContainer" class="list-container">
                </div>
        </div>

        <div id="registrationFormPage" style="display: none;">
            <h3>ë¬¼í’ˆ ë“±ë¡ ìš”ì²­</h3>
            <div class="form-content">
                
                <label for="itemName" class="form-label">ë¬¼í’ˆ ì´ë¦„</label>
                <input type="text" id="itemName" placeholder="ë¬¼í’ˆ ì´ë¦„">
                
                <label class="form-label" style="margin-top: 15px;">ë“±ë¡ì ì •ë³´ (í•„ìˆ˜)</label>
                <div class="info-group">
                    <input type="text" id="requesterName" placeholder="ì´ë¦„">
                    <select id="requesterDept">
                        </select>
                    <input type="text" id="requesterTeam" placeholder="íŒ€">
                    <input type="text" id="requesterId" placeholder="ê³ ìœ ë²ˆí˜¸">
                </div>

                <label for="itemCategory" class="form-label" style="margin-top: 15px;">ì¹´í…Œê³ ë¦¬ ì„ íƒ</label>
                <select id="itemCategory">
                    </select>

                <label for="itemImageFile" class="form-label" style="margin-top: 15px;">ë¬¼í’ˆ ì‚¬ì§„ íŒŒì¼ ì„ íƒ (ì„ íƒ)</label>
                <input type="file" id="itemImageFile" accept="image/*">
                
                <label for="itemDescription" class="form-label" style="margin-top: 15px;">ìƒì„¸ ì„¤ëª… ë° ë‚˜ëˆ” ì¡°ê±´</label>
                <textarea id="itemDescription" placeholder="ìƒì„¸ ì„¤ëª… ë° ë‚˜ëˆ” ì¡°ê±´ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."></textarea>
                
                <div class="form-actions">
                    <button onclick="addItemAsync()">ë“±ë¡ ìš”ì²­í•˜ê¸°</button>
                    <button class="cancel-btn" onclick="showPage('main')">ğŸ”™ ë’¤ë¡œê°€ê¸°</button>
                </div>
            </div>
        </div>

    </div>
    
    <footer>
        <button id="adminListBtn" onclick="showPage('adminListPage')" style="display: none;"></button>
    </footer>

    <script>
        let isAdmin = false;
        let adminDept = null; 
        
        let currentCategoryFilter = null; 
        let currentItemId = null; 
        
        // --- ê´€ë¦¬ì ë¡œê·¸ì¸ (ì œëª© 3íšŒ í´ë¦­) ë¡œì§ ---
        let headerClickCount = 0; 
        let lastClickTime = 0;
        const TIMEOUT_MS = 1000; 

        // ì œëª© í´ë¦­ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('headerTitle').addEventListener('click', function(event) {
            
            if (isAdmin) {
                return;
            }

            const now = Date.now();
            
            // 1ì´ˆ ì´ìƒ ê°„ê²©ì´ ë²Œì–´ì§€ë©´ ì¹´ìš´íŠ¸ ì´ˆê¸°í™”
            if (now - lastClickTime > TIMEOUT_MS) {
                headerClickCount = 1;
            } else {
                headerClickCount++;
            }
            
            lastClickTime = now;
            
            if (headerClickCount === 3) {
                headerClickCount = 0; // ì´ˆê¸°í™”
                loginAdmin(); // ê´€ë¦¬ì ë¡œê·¸ì¸ í•¨ìˆ˜ í˜¸ì¶œ
            }
        });
        // --- ê´€ë¦¬ì ë¡œê·¸ì¸ ë¡œì§ ë ---

        const categories = ['ìœ ì•„ìš©í’ˆ', 'ì˜ë¥˜', 'ì¡í™”', 'ì†Œí˜•ê°€ì „', 'ëŒ€í˜•ê°€ì „', 'ê°€êµ¬', 'ê¸°íƒ€'];
        const categoryIcons = {
            'ìœ ì•„ìš©í’ˆ': 'ğŸ¼',
            'ì˜ë¥˜': 'ğŸ‘•',
            'ì¡í™”': 'ğŸ‘œ',
            'ì†Œí˜•ê°€ì „': 'ğŸ”Œ',
            'ëŒ€í˜•ê°€ì „': 'ğŸ ',
            'ê°€êµ¬': 'ğŸ›‹ï¸',
            'ê¸°íƒ€': 'ğŸ', 
            'ì „ì²´ ë³´ê¸°': 'ğŸ”„'
        };
        const departments = ['1ë¶€', '2ë¶€', '3ë¶€', '4ë¶€']; 
        
        const adminPasswords = {
             '1ë¶€': 'dept1',
             '2ë¶€': 'dept2',
             '3ë¶€': 'dept3',
             '4ë¶€': 'dept4'
        };
        
        const NO_IMAGE_TEXT = 'ì´ë¯¸ì§€ ì—†ìŒ';
        const NO_IMAGE_PLACEHOLDER = 'https://via.placeholder.com/250/808080/FFFFFF?text=No+Image'; 
        const THUMBNAIL_PLACEHOLDER = 'https://via.placeholder.com/60/808080/FFFFFF?text=No+Img'; 
        
        function isValidImageUrl(url) {
            return url && url.trim() !== '' && url.indexOf('No+Image') === -1 && url.indexOf('No+Img') === -1;
        }

        // --- ì•„ì´í…œ ë°ì´í„° (ë¶€ì„œ ë°ì´í„° ë³´ê°•) ---
        const items = [
            { id: 1, name: 'ìœ ì•„ ì¹´ì‹œíŠ¸ (ISOFIX)', status: 'íŒë§¤ ì¤‘', description: 'ì‚¬ìš© ê¸°ê°„ 1ë…„ ë¯¸ë§Œ, ê¹¨ë—í•˜ê²Œ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. ì•ˆì „ê¸°ì¤€ í†µê³¼ ì œí’ˆ.', imageUrl: 'https://via.placeholder.com/150/007BFF/FFFFFF?text=CarSeat', historyStatus: 'ì‹ ì²­ ì—†ìŒ', category: 'ìœ ì•„ìš©í’ˆ', requesterInfo: { name: 'ê¹€ë‚˜ëˆ”', dept: '1ë¶€', team: 'ìš´ì˜íŒ€', id: 'A100' }, historyBuyerInfo: null, registerDate: '2025-11-10' },
            { id: 2, name: 'ì—¬ì„±ìš© ê²¨ìš¸ ì½”íŠ¸ (90)', status: 'ê±°ë˜ ì™„ë£Œ', description: 'ìš¸ 80% í˜¼ë°©, ìƒíƒœ ë§¤ìš° ì¢‹ìŠµë‹ˆë‹¤. ë“œë¼ì´í´ë¦¬ë‹ ì™„ë£Œ.', imageUrl: 'https://via.placeholder.com/150/8B4513/FFFFFF?text=Coat', historyStatus: 'ê±°ë˜ í™•ì •', category: 'ì˜ë¥˜', requesterInfo: { name: 'ì´ìŠ¤íƒ€ì¼', dept: '2ë¶€', team: 'í”„ë¡ íŠ¸', id: 'B201' }, historyBuyerInfo: { name: 'í…ŒìŠ¤íŠ¸êµ¬ë§¤ì2', dept: '2ë¶€', team: 'ë§ˆì¼€íŒ…íŒ€', id: 'B222' }, registerDate: '2025-11-11' },
            { id: 3, name: 'ìŠ¤í…Œì¸ë¦¬ìŠ¤ í…€ë¸”ëŸ¬ 500ml', status: 'ì˜ˆì•½ì¤‘', description: 'ìƒˆìƒí’ˆì´ë©° ë³´ì˜¨/ë³´ëƒ‰ ë›°ì–´ë‚©ë‹ˆë‹¤. ì‚¬ë¬´ì‹¤ì—ì„œ ìœ ìš©.', imageUrl: '', historyStatus: 'ì˜ˆì•½ ìŠ¹ì¸', category: 'ì¡í™”', requesterInfo: { name: 'ë°•ì§ì¥', dept: '3ë¶€', team: 'ë¶€ì‚°ì§€ì ', id: 'C305' }, historyBuyerInfo: { name: 'í…ŒìŠ¤íŠ¸êµ¬ë§¤ì1', dept: '1ë¶€', team: 'ê°œë°œíŒ€', id: 'A111' }, registerDate: '2025-11-12' },
            { id: 4, name: 'í•¸ë””í˜• ë¬´ì„  ì²­ì†Œê¸°', status: 'ìŠ¹ì¸ ëŒ€ê¸°', description: 'ê°„ë‹¨í•œ ì²­ì†Œìš©ìœ¼ë¡œ ì¢‹ìœ¼ë‚˜ ë°°í„°ë¦¬ ìˆ˜ëª…ì´ ì¡°ê¸ˆ ì¤„ì—ˆìŠµë‹ˆë‹¤.', imageUrl: null, historyStatus: 'ì‹ ì²­ ì—†ìŒ', category: 'ì†Œí˜•ê°€ì „', requesterInfo: { name: 'ìµœê¹”ë”', dept: '4ë¶€', team: 'ê³ ê³ í•™íŒ€', id: 'D410' }, historyBuyerInfo: null, registerDate: '2025-11-13' },
            { id: 5, name: 'ì ‘ì´ì‹ ì›ëª© í…Œì´ë¸”', status: 'ì˜ˆì•½ì¤‘', description: 'ë² ë€ë‹¤ë‚˜ ì›ë£¸ì— ì í•©í•œ ì‘ì€ í…Œì´ë¸”ì…ë‹ˆë‹¤. ë‹¤ë¦¬ ì ‘í˜ ê¸°ëŠ¥.', imageUrl: 'https://via.placeholder.com/150/A0522D/FFFFFF?text=Table', historyStatus: 'ì‹ ì²­ ì¤‘', category: 'ê°€êµ¬', requesterInfo: { name: 'í•œë¦¬ë¹™', dept: '1ë¶€', team: 'ì „ëµíŒ€', id: 'E500' }, historyBuyerInfo: { name: 'í…ŒìŠ¤íŠ¸êµ¬ë§¤ì1', dept: '1ë¶€', team: 'ê°œë°œíŒ€', id: 'A111' }, registerDate: '2025-11-13' },
            { id: 6, name: 'ì•„ê¸°ìš© ì²´ì˜¨ê³„', status: 'íŒë§¤ ì¤‘', description: 'ê·€ ì²´ì˜¨ê³„ì…ë‹ˆë‹¤. ì—¬ë¶„ í•„í„° ëª‡ ê°œ ê°™ì´ ë“œë¦½ë‹ˆë‹¤.', imageUrl: 'https://via.placeholder.com/150/FFC107/333333?text=Thermo', historyStatus: 'ì‹ ì²­ ì—†ìŒ', category: 'ìœ ì•„ìš©í’ˆ', requesterInfo: { name: 'ê°•ìœ¡ì•„', dept: '2ë¶€', team: 'íšŒê³„', id: 'F603' }, historyBuyerInfo: null, registerDate: '2025-11-14' },
            { id: 7, name: 'ë‚¨ì„± ì •ì¥ ë°”ì§€ (30ì¸ì¹˜)', status: 'ìŠ¹ì¸ ëŒ€ê¸°', description: 'ìŠ¬ë¦¼í•, ë„¤ì´ë¹„ ìƒ‰ìƒì…ë‹ˆë‹¤. ì‚¬ì´ì¦ˆê°€ ë§ì§€ ì•Šì•„ ë‚˜ëˆ”í•©ë‹ˆë‹¤.', imageUrl: '   ', historyStatus: 'ì‹ ì²­ ì—†ìŒ', category: 'ì˜ë¥˜', requesterInfo: { name: 'ê³ íŒ¨ì…˜', dept: '3ë¶€', team: 'ì±„ìš©', id: 'G777' }, historyBuyerInfo: null, registerDate: '2025-11-15' },
            { id: 8, name: 'ìº í•‘ìš© ì ‘ì´ì‹ ì˜ì 2ê°œ', status: 'íŒë§¤ ì¤‘', description: 'ì•¼ì™¸ ìº í•‘ ë° ë‚šì‹œìš©ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.', imageUrl: 'https://via.placeholder.com/150/228B22/FFFFFF?text=Chair', historyStatus: 'ì‹ ì²­ ì—†ìŒ', category: 'ê°€êµ¬', requesterInfo: { name: 'í™ìº í•‘', dept: '4ë¶€', team: 'ê°œë°œíŒ€', id: 'A110' }, historyBuyerInfo: null, registerDate: '2025-11-16' },
            { id: 9, name: 'ë¯¸ë‹ˆ ê³µê¸°ì²­ì •ê¸° (ì°¨ëŸ‰ìš©)', status: 'ì˜ˆì•½ì¤‘', description: 'USB ì „ì› ì‚¬ìš©. ì°¨ëŸ‰ì´ë‚˜ ì‘ì€ ë°©ì— ì í•©í•©ë‹ˆë‹¤.', imageUrl: 'https://via.placeholder.com/150/00FFFF/000000?text=AirPuri', historyStatus: 'ì‹ ì²­ ì¤‘', category: 'ì†Œí˜•ê°€ì „', requesterInfo: { name: 'ì´ë§‘ìŒ', dept: '1ë¶€', team: 'ì´ë¬´íŒ€', id: 'B221' }, historyBuyerInfo: { name: 'í…ŒìŠ¤íŠ¸êµ¬ë§¤ì2', dept: '2ë¶€', team: 'ë§ˆì¼€íŒ…íŒ€', id: 'B222' }, registerDate: '2025-11-17' },
            { id: 10, name: 'ë¶„ìœ  í¬íŠ¸ (ì˜¨ë„ ìœ ì§€ ê¸°ëŠ¥)', status: 'ì˜ˆì•½ì¤‘', description: 'ì‹ ìƒì•„ ë¶„ìœ  íƒ€ê¸°ì— ìµœì í™”ëœ í¬íŠ¸. ì‚¬ìš©ê° ìˆìŠµë‹ˆë‹¤.', imageUrl: 'https://via.placeholder.com/150/DC3545/FFFFFF?text=FormulaPot', historyStatus: 'ì˜ˆì•½ ìŠ¹ì¸', category: 'ìœ ì•„ìš©í’ˆ', requesterInfo: { name: 'ì •ë¶€ëª¨', dept: '2ë¶€', team: 'ì¸ì‚¬', id: 'C300' }, historyBuyerInfo: { name: 'í…ŒìŠ¤íŠ¸êµ¬ë§¤ì1', dept: '1ë¶€', team: 'ê°œë°œíŒ€', id: 'A111' }, registerDate: '2025-11-18' },
            { id: 11, name: 'ì—¬í–‰ìš© ë°±íŒ© (30L)', status: 'ê±°ë˜ ì™„ë£Œ', description: '3ë°• 4ì¼ ì—¬í–‰ìš©ìœ¼ë¡œ ì í•©í•œ ë°±íŒ©. ë…¸íŠ¸ë¶ ìˆ˜ë‚© ê³µê°„ ë³„ë„.', imageUrl: 'https://via.placeholder.com/150/A9A9A9/000000?text=Backpack', historyStatus: 'ê±°ë˜ í™•ì •', category: 'ì¡í™”', requesterInfo: { name: 'ë°•ì—¬í–‰', dept: '3ë¶€', team: 'AIë©', id: 'D440' }, historyBuyerInfo: { name: 'í…ŒìŠ¤íŠ¸êµ¬ë§¤ì1', dept: '1ë¶€', team: 'ê°œë°œíŒ€', id: 'A111' }, registerDate: '2025-11-19' },
            { id: 12, name: '27ì¸ì¹˜ LED ëª¨ë‹ˆí„°', status: 'íŒë§¤ ì¤‘', description: 'í™”ë©´ ìƒíƒœ ì–‘í˜¸í•˜ë©°, HDMI ì¼€ì´ë¸” í•¨ê»˜ ë“œë¦½ë‹ˆë‹¤. ì¬íƒê·¼ë¬´ìš©.', imageUrl: 'https://via.placeholder.com/150/800080/FFFFFF?text=Monitor', historyStatus: 'ì‹ ì²­ ì—†ìŒ', category: 'ì†Œí˜•ê°€ì „', requesterInfo: { name: 'ìµœê°œë°œ', dept: '4ë¶€', team: 'ì»¨í…ì¸ íŒ€', id: 'E550' }, historyBuyerInfo: null, registerDate: '2025-11-20' },
            { id: 13, name: 'ì–‘ë¬¸í˜• ëƒ‰ì¥ê³  (êµ¬í˜•)', status: 'íŒë§¤ ì¤‘', description: '10ë…„ ëœ êµ¬í˜• ëª¨ë¸ì´ë‚˜ ì‘ë™ì— ë¬¸ì œ ì—†ìŠµë‹ˆë‹¤. ì§ì ‘ ìš´ë°˜í•˜ì…”ì•¼ í•©ë‹ˆë‹¤.', imageUrl: 'https://via.placeholder.com/150/4682B4/FFFFFF?text=Fridge', historyStatus: 'ì‹ ì²­ ì—†ìŒ', category: 'ëŒ€í˜•ê°€ì „', requesterInfo: { name: 'í•œì‚´ë¦¼', dept: '1ë¶€', team: 'ì„¸ë¬´', id: 'F663' }, historyBuyerInfo: null, registerDate: '2025-11-21' },
            { id: 14, name: 'ì—¬ì„±ìš© ê°€ì£½ ì¥ê°‘', status: 'íŒë§¤ ì¤‘', description: 'ë¸”ë™ ìƒ‰ìƒ, ì•ˆê° ê¸°ëª¨ ì²˜ë¦¬ëœ ê²¨ìš¸ ì¥ê°‘.', imageUrl: 'https://via.placeholder.com/150/556B2F/FFFFFF?text=Glove', historyStatus: 'ì‹ ì²­ ì—†ìŒ', category: 'ì˜ë¥˜', requesterInfo: { name: 'ê°•ê²¨ìš¸', dept: '2ë¶€', team: 'êµìœ¡', id: 'G770' }, historyBuyerInfo: null, registerDate: '2025-11-22' },
            { id: 15, name: 'ì „ê¸° í¬íŠ¸ (1.5L)', status: 'íŒë§¤ ì¤‘', description: 'ë¹ ë¥¸ ê°€ì—´ ê¸°ëŠ¥. ì£¼ì „ì ëª¨ì–‘ì´ ê·€ì—½ìŠµë‹ˆë‹¤.', imageUrl: 'https://via.placeholder.com/150/FF4500/FFFFFF?text=Pot', historyStatus: 'ì‹ ì²­ ì—†ìŒ', category: 'ì†Œí˜•ê°€ì „', requesterInfo: { name: 'ë¬¸ì£¼ë¶€', dept: '3ë¶€', team: 'ë²•ë¬´', id: 'H888' }, historyBuyerInfo: null, registerDate: '2025-11-23' },
            { id: 16, name: 'í€¸ ì‚¬ì´ì¦ˆ ë§¤íŠ¸ë¦¬ìŠ¤ (5ë…„ ì‚¬ìš©)', status: 'íŒë§¤ ì¤‘', description: 'ìŠ¤í”„ë§ ìƒíƒœ ì–‘í˜¸í•˜ë‚˜, ì˜¤ì—¼ì´ ì¼ë¶€ ìˆì–´ ì»¤ë²„ ì‚¬ìš© ê¶Œì¥.', imageUrl: 'https://via.placeholder.com/150/808080/FFFFFF?text=Mattress', historyStatus: 'ì‹ ì²­ ì—†ìŒ', category: 'ê°€êµ¬', requesterInfo: { name: 'ì´ì ë³´', dept: '4ë¶€', team: 'ìš´ì˜íŒ€', id: 'I999' }, historyBuyerInfo: null, registerDate: '2025-11-24' },
            { id: 17, name: 'ì—ì–´ì»¨ (ë²½ê±¸ì´í˜•)', status: 'ìŠ¹ì¸ ëŒ€ê¸°', description: 'ì‘ë…„ê¹Œì§€ ì‚¬ìš©. ëƒ‰ë§¤ ë³´ì¶© í•„ìš”í•  ìˆ˜ ìˆìŒ. ì„¤ì¹˜ ê¸°ì‚¬ í•„ìš”.', imageUrl: 'https://via.placeholder.com/150/1E90FF/FFFFFF?text=AC', historyStatus: 'ì‹ ì²­ ì—†ìŒ', category: 'ëŒ€í˜•ê°€ì „', requesterInfo: { name: 'ê¹€ì—¬ë¦„', dept: '1ë¶€', team: 'ê¸°ìˆ ì§€ì›', id: 'A101' }, historyBuyerInfo: null, registerDate: '2025-11-25' },
            { id: 18, name: 'ì—¬ì„±ìš© ìˆ„ë”ë°±', status: 'íŒë§¤ ì¤‘', description: 'í•©ì„±í”¼í˜, ë°ì¼ë¦¬ìš©ìœ¼ë¡œ ì í•©í•©ë‹ˆë‹¤. ìƒíƒœ Bê¸‰.', imageUrl: 'https://via.placeholder.com/150/FF6347/FFFFFF?text=Bag', historyStatus: 'ì‹ ì²­ ì—†ìŒ', category: 'ì¡í™”', requesterInfo: { name: 'ì´ë§ˆì¼“', dept: '2ë¶€', team: 'ë§ˆì¼€íŒ…íŒ€', id: 'B202' }, historyBuyerInfo: null, registerDate: '2025-11-26' },
            { id: 19, name: 'ìƒˆí‹´ ë² ê°œ ì»¤ë²„ 2ê°œ', status: 'ê±°ë˜ ì™„ë£Œ', description: 'ìƒˆìƒí’ˆì…ë‹ˆë‹¤. ìƒ‰ìƒì€ ì•„ì´ë³´ë¦¬.', imageUrl: 'https://via.placeholder.com/150/F0FFF0/000000?text=Pillow', historyStatus: 'ê±°ë˜ í™•ì •', category: 'ê¸°íƒ€', requesterInfo: { name: 'ë°•ì§ë¬¼', dept: '3ë¶€', team: 'ë¸Œëœë“œíŒ€', id: 'E501' }, historyBuyerInfo: { name: 'í…ŒìŠ¤íŠ¸êµ¬ë§¤ì2', dept: '2ë¶€', team: 'ë§ˆì¼€íŒ…íŒ€', id: 'B222' }, registerDate: '2025-11-27' },
            { id: 20, name: 'ì•„ê¸° ë°”ìš´ì„œ', status: 'ì˜ˆì•½ì¤‘', description: 'ì§„ë™ ê¸°ëŠ¥ ì˜ ì‘ë™í•©ë‹ˆë‹¤. ì‹œíŠ¸ ì„¸íƒ ì™„ë£Œ.', imageUrl: 'https://via.placeholder.com/150/FFD700/000000?text=Bouncer', historyStatus: 'ì˜ˆì•½ ìŠ¹ì¸', category: 'ìœ ì•„ìš©í’ˆ', requesterInfo: { name: 'ìµœë†€ì´', dept: '4ë¶€', team: 'ìê¸ˆ', id: 'F604' }, historyBuyerInfo: { name: 'í…ŒìŠ¤íŠ¸êµ¬ë§¤ì1', dept: '1ë¶€', team: 'ê°œë°œíŒ€', id: 'A111' }, registerDate: '2025-11-28' },
            { id: 21, name: 'íšŒì‚¬ ë¡œê³  ê¸°ë… ìš°ì‚°', status: 'íŒë§¤ ì¤‘', description: 'ë¹„ë‹ ìš°ì‚° 2ê°œ. íšŒì‚¬ ì°½ë¦½ ê¸°ë…í’ˆ.', imageUrl: 'https://via.placeholder.com/150/7FFFD4/000000?text=Umbrella', historyStatus: 'ì‹ ì²­ ì—†ìŒ', category: 'ê¸°íƒ€', requesterInfo: { name: 'ê¹€ì´ë¬´', dept: '1ë¶€', team: 'ì´ë¬´íŒ€', id: 'G900' }, historyBuyerInfo: null, registerDate: '2025-11-29' } 
        ];

        // ì´ˆê¸°í™” í•¨ìˆ˜
        window.onload = function() {
            showPage('main');
        };

        // --- í˜ì´ì§€ ì „í™˜ ê´€ë¦¬ í•¨ìˆ˜ ---
        function showPage(pageId, itemId = null) {
            const pages = ['mainContent', 'registrationFormPage', 'adminListPage', 'categoryPage', 'itemDetailPage'];
            pages.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.style.display = 'none';
                }
            });

            if (pageId === 'main') {
                document.getElementById('mainContent').style.display = 'block';
                searchItems();
            } else if (pageId === 'registrationFormPage') {
                document.getElementById('registrationFormPage').style.display = 'block';
                renderCategorySelect();
                renderDeptSelect('requesterDept');
            } else if (pageId === 'adminListPage') {
                document.getElementById('adminListPage').style.display = 'block';
                // ê´€ë¦¬ì ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ë° ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
                if (isAdmin) {
                    document.getElementById('currentAdminDept').textContent = adminDept;
                    renderAdminList();
                } else {
                    alert('ê´€ë¦¬ì ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                    showPage('main');
                }
            } else if (pageId === 'categoryPage') {
                document.getElementById('categoryPage').style.display = 'block';
                renderCategoryGrid(); 
            } else if (pageId === 'itemDetailPage' && itemId !== null) {
                document.getElementById('itemDetailPage').style.display = 'block';
                renderItemDetailPage(itemId);
            }
            
            updateFooterButtons();
        }

        // --- ìƒíƒœ ê´€ë ¨ í—¬í¼ í•¨ìˆ˜ ---
        function getStatusClass(status) {
            if (status === 'ìŠ¹ì¸ ëŒ€ê¸°') return 'status-waiting';
            if (status === 'íŒë§¤ ì¤‘') return 'status-selling';
            if (status === 'ì˜ˆì•½ì¤‘') return 'status-reserved';
            if (status === 'ê±°ë˜ ì™„ë£Œ') return 'status-completed';
            if (status === 'ê±°ë˜ ì·¨ì†Œ') return 'status-cancelled';
            return '';
        }

        // ì¼ë°˜ ì‚¬ìš©ìì—ê²Œ í‘œì‹œë˜ëŠ” ìƒíƒœ í…ìŠ¤íŠ¸
        function getDisplayStatusText(internalStatus, item) {
            if (internalStatus === 'ìŠ¹ì¸ ëŒ€ê¸°') return 'ìŠ¹ì¸ ëŒ€ê¸°';
            if (internalStatus === 'íŒë§¤ ì¤‘') return 'ì‹ ì²­ ê°€ëŠ¥';
            if (internalStatus === 'ê±°ë˜ ì™„ë£Œ') { return 'ë‚˜ëˆ” ì™„ë£Œ'; }
            if (internalStatus === 'ì˜ˆì•½ì¤‘') { 
                // ê´€ë¦¬ìê°€ ì•„ë‹ ê²½ìš° 'ì˜ˆì•½ì¤‘'ìœ¼ë¡œ í†µì¼
                if (!isAdmin) return 'ì˜ˆì•½ì¤‘'; 
                
                // ê´€ë¦¬ìì¼ ê²½ìš° ìƒì„¸ ìƒíƒœ í‘œì‹œ ìœ ì§€
                if (item.historyStatus === 'ì˜ˆì•½ ìŠ¹ì¸') {
                    return 'ì˜ˆì•½ í™•ì • (2ì°¨ ëŒ€ê¸°)';
                } else if (item.historyStatus === 'ì‹ ì²­ ì¤‘') {
                    return 'ì˜ˆì•½ ëŒ€ê¸° (1ì°¨ ëŒ€ê¸°)';
                } else {
                    return 'ì˜ˆì•½ì¤‘';
                }
            }
            return internalStatus;
        }

        // --- ì¹´í…Œê³ ë¦¬ í˜ì´ì§€ ê´€ë ¨ í•¨ìˆ˜ ---
        function renderCategoryGrid() {
            const gridContainer = document.querySelector('#categoryPage .category-grid');
            gridContainer.innerHTML = '';

            categories.forEach(category => {
                const item = document.createElement('div');
                item.classList.add('category-item');
                const icon = categoryIcons[category] || 'â“';
                item.innerHTML = `<span class="category-icon">${icon}</span> ${category}`;
                item.onclick = () => {
                    filterByCategory(category);
                    showPage('main');
                };
                gridContainer.appendChild(item);
            });
            
            const allItem = document.createElement('div');
            allItem.classList.add('category-item');
            const allIcon = categoryIcons['ì „ì²´ ë³´ê¸°'] || 'ğŸ”„';
            allItem.innerHTML = `<span class="category-icon">${allIcon}</span> ì „ì²´ ë³´ê¸°`;
            allItem.onclick = () => {
                filterByCategory(null);
                showPage('main');
            };
            gridContainer.appendChild(allItem);
        }

        function filterByCategory(category) {
            currentCategoryFilter = category;
            const display = document.getElementById('currentCategoryDisplay');
            const nameSpan = document.getElementById('selectedCategoryName');

            if (category) {
                display.style.display = 'block';
                nameSpan.textContent = category;
            } else {
                display.style.display = 'none';
                nameSpan.textContent = '';
            }
            searchItems();
        }

        function renderCategorySelect() {
            const select = document.getElementById('itemCategory');
            select.innerHTML = '<option value="">--- ì¹´í…Œê³ ë¦¬ ì„ íƒ ---</option>';
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                select.appendChild(option);
            });
        }

        // --- ë¶€ì„œ ì„ íƒ ë“œë¡­ë‹¤ìš´ ë Œë”ë§ í•¨ìˆ˜ ---
        function renderDeptSelect(elementId, defaultValue = '') {
            const select = document.getElementById(elementId);
            if (!select) return;

            select.innerHTML = `<option value="">--- ë¶€ì„œ ì„ íƒ (í•„ìˆ˜) ---</option>`;
            departments.forEach(dept => {
                const option = document.createElement('option');
                option.value = dept;
                option.textContent = dept;
                if (dept === defaultValue) {
                    option.selected = true;
                }
                select.appendChild(option);
            });
        }

        // --- ë¬¼í’ˆ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§ í•¨ìˆ˜ (ë©”ì¸ í˜ì´ì§€) ---
        function renderItems(filteredItems) {
            const listContainer = document.getElementById('item-list-container');
            listContainer.innerHTML = '';

            // ì¹´í…Œê³ ë¦¬ í•„í„°ë§ ì ìš©
            let filteredByCat = filteredItems;
            if (currentCategoryFilter) {
                filteredByCat = filteredItems.filter(item => item.category === currentCategoryFilter);
            }

            // ê´€ë¦¬ìê°€ ì•„ë‹Œ ê²½ìš° 'ìŠ¹ì¸ ëŒ€ê¸°', 'ê±°ë˜ ì™„ë£Œ' ë¬¼í’ˆ ì œì™¸ (ë©”ì¸ ëª©ë¡)
            let finalDisplayItems = filteredByCat;
            if (!isAdmin) {
                finalDisplayItems = filteredByCat.filter(item => item.status !== 'ìŠ¹ì¸ ëŒ€ê¸°' && item.status !== 'ê±°ë˜ ì™„ë£Œ');
            }

            if (finalDisplayItems.length === 0) {
                listContainer.innerHTML = '<p style="text-align: center; color: #777; padding: 20px; margin: 0;">í•´ë‹¹ ì¡°ê±´ì— ë§ëŠ” ë¬¼í’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            finalDisplayItems.forEach(item => {
                const isNoImage = !isValidImageUrl(item.imageUrl);
                const displayImageUrl = isNoImage ? THUMBNAIL_PLACEHOLDER : item.imageUrl;
                let thumbnailHtml = '';

                if (isNoImage) {
                    thumbnailHtml = `<div class="item-thumbnail-wrapper">${NO_IMAGE_TEXT}</div>`;
                } else {
                    thumbnailHtml = `<div class="item-thumbnail-wrapper"><img src="${displayImageUrl}" alt="${item.name} ì´ë¯¸ì§€" class="item-thumbnail"></div>`;
                }
                
                // ë¬¼í’ˆëª… ìš°ì¸¡ì— ë‚˜ì˜¤ëŠ” ìƒíƒœ í…ìŠ¤íŠ¸ëŠ” ì¼ë°˜ ì‚¬ìš©ìì—ê²Œ ë‹¨ìˆœí™”ëœ í…ìŠ¤íŠ¸ë¥¼ ì‚¬ìš©
                let statusText = getDisplayStatusText(item.status, item);
                let statusClass = getStatusClass(item.status);

                // ì¹´í…Œê³ ë¦¬ ì•„ë˜ ì•¡ì…˜ ë²„íŠ¼/í…ìŠ¤íŠ¸ ì˜ì—­ ë¡œì§ ë³€ê²½
                let actionButton = '';
                if (isAdmin) {
                    // ê´€ë¦¬ìì—ê²ŒëŠ” ë©”ì¸ ëª©ë¡ì—ì„œ ìˆ˜ì •/ì‚­ì œ ê¸°ëŠ¥ì€ ìˆ¨ê¸°ê³  ìƒì„¸ ë³´ê¸°ë§Œ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤. (í˜¼ë€ ë°©ì§€)
                } else if (item.status === 'íŒë§¤ ì¤‘') {
                    // íŒë§¤ ì¤‘ì¼ ë•Œë§Œ ì‹ ì²­ ë²„íŠ¼ í‘œì‹œ
                    actionButton = `<button class="action-btn trade-apply-btn" onclick="showPage('itemDetailPage', ${item.id})">ë‚˜ëˆ” ì‹ ì²­</button>`;
                } else if (item.status === 'ì˜ˆì•½ì¤‘') {
                    // ì˜ˆì•½ì¤‘ì¼ ë•ŒëŠ” í…ìŠ¤íŠ¸ë§Œ í‘œì‹œ
                    actionButton = `<span class="${statusClass}">${statusText}</span>`;
                }

                // ë“±ë¡ì ì •ë³´ í‘œì‹œ ì—¬ë¶€ ê²°ì • (ê´€ë¦¬ì ì „ìš©)
                let requesterInfoPart = '';
                if (isAdmin) {
                    requesterInfoPart = ` | ë“±ë¡ì: ${item.requesterInfo.name} (${item.requesterInfo.dept})`;
                }
                
                const card = document.createElement('div');
                card.classList.add('item-card');
                card.setAttribute('data-id', item.id);
                card.innerHTML = `
                    ${thumbnailHtml}
                    <div class="item-content">
                        <div class="item-header">
                            <span class="item-name" title="${item.name}">${item.name}</span>
                            <span class="item-status ${statusClass}">${statusText}</span>
                        </div>
                        <div class="item-info">
                            ì¹´í…Œê³ ë¦¬: ${item.category || 'ë¯¸ë¶„ë¥˜'} | ë“±ë¡ì¼: ${item.registerDate || '-'} ${requesterInfoPart}
                        </div>
                        <div class="item-actions">
                            ${actionButton}
                        </div>
                    </div>
                `;
                card.onclick = (event) => toggleDetails(item.id, event);
                listContainer.appendChild(card);
                
                const detailDiv = document.createElement('div');
                detailDiv.classList.add('detail-row');
                detailDiv.id = `detail-${item.id}`;
                
                const formattedDescription = (item.description || 'ìƒì„¸ ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤.').replace(/\n/g, '<br>');

                // ìƒì„¸ ì´ë¯¸ì§€ ë¡œì§
                let detailImageHtml = '';
                if (isNoImage) {
                    detailImageHtml = `<div class="detail-image-box no-image">${NO_IMAGE_TEXT}</div>`;
                } else {
                    detailImageHtml = `<div class="detail-image-box"><img src="${item.imageUrl}" alt="${item.name} ì´ë¯¸ì§€ ìƒì„¸"></div>`;
                }

                // ë“±ë¡ì ì •ë³´
                const requesterInfoHtml = `
                    <div class="detail-text">
                        <strong>ë“±ë¡ì ì •ë³´:</strong><br>
                        ì´ë¦„: ${item.requesterInfo.name} | ë¶€ì„œ: ${item.requesterInfo.dept} | íŒ€: ${item.requesterInfo.team} | ê³ ìœ ë²ˆí˜¸: ${item.requesterInfo.id}
                    </div>
                `;
                
                // ê´€ë¦¬ì ì „ìš© ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼
                let deleteButtonHtml = '';
                if (isAdmin && adminDept === item.requesterInfo.dept) {
                    deleteButtonHtml = `
                        <button class="action-btn edit-btn" onclick="editItem(${item.id})">âœï¸ ë¬¼í’ˆ ìˆ˜ì • (ê´€ë¦¬ì)</button>
                        <button class="action-btn delete-btn" onclick="deleteItem(${item.id})">ğŸ—‘ï¸ ë¬¼í’ˆ ì‚­ì œ (ê´€ë¦¬ì)</button>
                    `;
                }

                let buyerInfoHtml = '';
                if (isAdmin && item.historyBuyerInfo) {
                    buyerInfoHtml = `
                        <div class="detail-text" style="margin-top: 15px; border-top: 1px dashed #ccc; padding-top: 10px;">
                            <strong>ì‹ ì²­ì ì •ë³´ (ê´€ë¦¬ì ì „ìš©):</strong><br>
                            ì´ë¦„: ${item.historyBuyerInfo.name} | ë¶€ì„œ: ${item.historyBuyerInfo.dept} | íŒ€: ${item.historyBuyerInfo.team} | ê³ ìœ ë²ˆí˜¸: ${item.historyBuyerInfo.id}
                        </div>
                    `;
                }

                detailDiv.innerHTML = `
                    <div class="detail-content">
                        ${detailImageHtml}
                        <div class="detail-text" style="margin-bottom: 15px;">
                            <strong>ìƒì„¸ ì„¤ëª…:</strong><br>
                            ${formattedDescription}
                        </div>
                        ${requesterInfoHtml}
                        ${buyerInfoHtml}
                        <div class="item-actions" style="margin-top: 20px; text-align: right;">
                            ${deleteButtonHtml}
                        </div>
                    </div>
                `;
                listContainer.appendChild(detailDiv);
            });

            updateAdminButtonStatus();
        }

        // --- ë¬¼í’ˆ ìƒì„¸ ë° ì‹ ì²­ í˜ì´ì§€ ë Œë”ë§ í•¨ìˆ˜ ---
        function renderItemDetailPage(itemId) {
            const item = items.find(i => i.id === itemId);
            const detailPage = document.getElementById('itemDetailPage');
            currentItemId = itemId;

            if (!item || item.status !== 'íŒë§¤ ì¤‘') {
                detailPage.innerHTML = `
                    <h3>ğŸš« ë‚˜ëˆ” ì‹ ì²­ ë¶ˆê°€</h3>
                    <p>ì´ ë¬¼í’ˆì€ í˜„ì¬ ì‹ ì²­ ê°€ëŠ¥í•œ ìƒíƒœê°€ ì•„ë‹™ë‹ˆë‹¤.</p>
                    <button class="cancel-btn" onclick="showPage('main')">ğŸ”™ ë’¤ë¡œê°€ê¸°</button>
                `;
                return;
            }

            const isNoImage = !isValidImageUrl(item.imageUrl);
            const displayImageUrl = isNoImage ? NO_IMAGE_PLACEHOLDER : item.imageUrl;
            let imageHtml = '';
            if (isNoImage) {
                imageHtml = `<div class="image-container no-image-detail">${NO_IMAGE_TEXT}</div>`;
            } else {
                imageHtml = `<div class="image-container"><img src="${displayImageUrl}" alt="${item.name} ì´ë¯¸ì§€"></div>`;
            }

            // ì‹ ì²­ í¼ì— ì‚¬ìš©ë  ë¶€ì„œ ë“œë¡­ë‹¤ìš´ì„ ë¯¸ë¦¬ ë Œë”ë§í•©ë‹ˆë‹¤.
            renderDeptSelect('applyDept');

            detailPage.innerHTML = `
                <h3>â­ ë‚˜ëˆ” ì‹ ì²­: ${item.name}</h3>
                <div class="item-detail-info">
                    ${imageHtml}
                    <div class="text-content">
                        <h2>${item.name}</h2>
                        <p>${item.description.replace(/\n/g, '<br>')}</p>
                        <strong>ì¹´í…Œê³ ë¦¬: ${item.category || 'ë¯¸ë¶„ë¥˜'}</strong>
                        <strong>ë“±ë¡ì¼: ${item.registerDate || '-'}</strong>
                        <strong style="color:#555;">ë“±ë¡ì: ${item.requesterInfo.name} (${item.requesterInfo.dept} ${item.requesterInfo.team})</strong>
                    </div>
                </div>

                <div class="application-form-section">
                    <h4>ë‚˜ëˆ” ì‹ ì²­ ì •ë³´ ì…ë ¥</h4>
                    <label class="form-label">ì‹ ì²­ì ì •ë³´ (í•„ìˆ˜)</label>
                    <div class="info-group">
                        <input type="text" id="applyName" placeholder="ì‹ ì²­ì ì´ë¦„">
                        <select id="applyDept">
                            </select>
                        <input type="text" id="applyTeam" placeholder="íŒ€">
                        <input type="text" id="applyId" placeholder="ê³ ìœ ë²ˆí˜¸ (ê°œì¸ ì‹ë³„ìš©)">
                    </div>

                    <label for="applyDescription" class="form-label" style="margin-top: 15px;">ë‚˜ëˆ”ì´ í•„ìš”í•œ ì´ìœ  / í¬ë§ ì „ë‹¬ ë°©ì‹ ë“±</label>
                    <textarea id="applyDescription" placeholder="ë¬¼í’ˆì„ ë‚˜ëˆ” ë°›ê³  ì‹¶ì€ ì´ìœ ë‚˜ í¬ë§ ì „ë‹¬ ì‚¬í•­ì„ ê°„ëµíˆ ì‘ì„±í•´ì£¼ì„¸ìš”."></textarea>
                    
                    <div class="form-actions" style="text-align: right;">
                        <button class="trade-apply-btn" onclick="applyForItem(${item.id})">ë‚˜ëˆ” ì‹ ì²­ í™•ì •</button>
                        <button class="cancel-btn" onclick="showPage('main')">ğŸ”™ ëª©ë¡ìœ¼ë¡œ</button>
                    </div>
                </div>
            `;
        }
        
        // --- ìƒì„¸ ì •ë³´ í† ê¸€ í•¨ìˆ˜ ---
        function toggleDetails(itemId, event) {
            const detailDiv = document.getElementById(`detail-${itemId}`);
            const card = document.querySelector(`.item-card[data-id="${itemId}"]`);
            
            // ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ëŠ” ìƒì„¸ ì •ë³´ í† ê¸€ì„ ë§‰ìŠµë‹ˆë‹¤.
            if (event && (event.target.classList.contains('action-btn') || event.target.closest('.item-actions'))) {
                return;
            }

            if (detailDiv) {
                const isHidden = detailDiv.style.display === 'none' || detailDiv.style.display === '';
                detailDiv.style.display = isHidden ? 'block' : 'none';
                card.style.marginBottom = isHidden ? '0' : '15px'; 
                card.style.borderBottomLeftRadius = isHidden ? '8px' : '0';
                card.style.borderBottomRightRadius = isHidden ? '8px' : '0';
                
                // ìŠ¤í¬ë¡¤ ì´ë™
                if (isHidden) {
                    detailDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
        }

        // --- í‘¸í„° ë²„íŠ¼ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ---
        function updateFooterButtons() {
            const footer = document.querySelector('footer');
            const adminListBtn = document.getElementById('adminListBtn');
            let logoutBtn = document.getElementById('dynamicLogoutBtn');

            // ê¸°ì¡´ ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ì œê±°
            if (logoutBtn) {
                logoutBtn.remove();
            }

            if (isAdmin) {
                // ê´€ë¦¬ì ë¡œê·¸ì¸ ìƒíƒœì—ì„œëŠ” í‘¸í„° ë³´ì´ê¸°
                footer.style.display = 'flex'; 
                
                // ê´€ë¦¬ ëª©ë¡ ë²„íŠ¼ í‘œì‹œ
                adminListBtn.style.display = 'block';
                adminListBtn.textContent = 'ğŸš¨ ê´€ë¦¬ ëª©ë¡';
                
                // ë™ì  ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ìƒì„± ë° ì¶”ê°€
                logoutBtn = document.createElement('button');
                logoutBtn.id = 'dynamicLogoutBtn';
                logoutBtn.textContent = `ë¡œê·¸ì•„ì›ƒ (${adminDept})`;
                logoutBtn.onclick = logoutAdmin;

                // ìŠ¤íƒ€ì¼ ì ìš©
                logoutBtn.style.backgroundColor = '#92b0e8'; 
                logoutBtn.style.color = 'white';
                logoutBtn.style.padding = '10px 18px';
                logoutBtn.style.fontWeight = 'bold';
                logoutBtn.style.boxShadow = '0 2px 4px rgba(146, 176, 232, 0.4)';
                logoutBtn.onmouseover = () => logoutBtn.style.backgroundColor = '#7a9fd2';
                logoutBtn.onmouseout = () => logoutBtn.style.backgroundColor = '#92b0e8';

                // footerì— ë²„íŠ¼ ì¶”ê°€ (ê´€ë¦¬ ëª©ë¡ ë²„íŠ¼ ë’¤ì— ì‚½ì…)
                footer.appendChild(logoutBtn);

            } else {
                // ë¹„ë¡œê·¸ì¸ ìƒíƒœì—ì„œëŠ” í‘¸í„° ìˆ¨ê¹€
                footer.style.display = 'none';
                adminListBtn.style.display = 'none';
            }
        }

        // --- ê¸°íƒ€ ê¸°ëŠ¥ (íŒŒì¼, ë“±ë¡, ê²€ìƒ‰ ë“±) ---
        function convertFileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                const maxSizeInBytes = 2 * 1024 * 1024; // 2MB

                if (file.size > maxSizeInBytes) {
                    reject(new Error("File size exceeds 2MB limit."));
                    return;
                }
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
                reader.readAsDataURL(file);
            });
        }

        async function addItemAsync() {
            const name = document.getElementById('itemName').value.trim();
            const rName = document.getElementById('requesterName').value.trim();
            const rDept = document.getElementById('requesterDept').value.trim();
            const rTeam = document.getElementById('requesterTeam').value.trim();
            const rId = document.getElementById('requesterId').value.trim();
            const category = document.getElementById('itemCategory').value.trim();
            const description = document.getElementById('itemDescription').value.trim();
            const imageFile = document.getElementById('itemImageFile').files[0];
            let imageUrl = '';
            
            if (!name || !rName || !rDept || !rTeam || !rId || !category || !description) {
                alert('ëª¨ë“  í•„ìˆ˜ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            if (imageFile) {
                try {
                    // íŒŒì¼ í¬ê¸° ì œí•œ ê²€ì‚¬
                    if (imageFile.size > 2 * 1024 * 1024) { 
                        alert('íŒŒì¼ í¬ê¸°ê°€ 2MBë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤. ë‹¤ë¥¸ íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                        return;
                    }
                    imageUrl = await convertFileToBase64(imageFile);
                } catch (error) {
                    alert(`ì´ë¯¸ì§€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`);
                    return;
                }
            }

            // ìƒˆë¡œìš´ ID í• ë‹¹
            const newId = items.length > 0 ? Math.max(...items.map(i => i.id)) + 1 : 1;
            const today = new Date().toISOString().split('T')[0];

            const newItem = {
                id: newId,
                name: name,
                status: 'ìŠ¹ì¸ ëŒ€ê¸°', // ì´ˆê¸° ìƒíƒœ: ìŠ¹ì¸ ëŒ€ê¸°
                description: description,
                imageUrl: imageUrl,
                historyStatus: 'ì‹ ì²­ ì—†ìŒ', 
                category: category,
                requesterInfo: { name: rName, dept: rDept, team: rTeam, id: rId },
                historyBuyerInfo: null,
                registerDate: today
            };
            
            items.push(newItem);

            // í¼ ì´ˆê¸°í™”
            document.getElementById('itemName').value = '';
            document.getElementById('requesterName').value = '';
            document.getElementById('requesterDept').value = '';
            document.getElementById('requesterTeam').value = '';
            document.getElementById('requesterId').value = '';
            document.getElementById('itemCategory').value = '';
            document.getElementById('itemDescription').value = '';
            document.getElementById('itemImageFile').value = ''; // íŒŒì¼ ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            
            alert(`ë¬¼í’ˆ [${name}]ì˜ ë“±ë¡ ìš”ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë“±ë¡ì ë¶€ì„œ(${rDept}) ê´€ë¦¬ìì˜ ìŠ¹ì¸ì„ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.`);
            showPage('main');
        }

        // ê²€ìƒ‰ ì…ë ¥ í•„ë“œ ì§€ìš°ê¸° í•¨ìˆ˜
        function clearSearchInput() {
            const searchInput = document.getElementById('searchInput');
            const clearBtn = document.getElementById('clearSearchBtn');

            searchInput.value = ''; // ê°’ ì´ˆê¸°í™”
            clearBtn.style.display = 'none'; // ë²„íŠ¼ ìˆ¨ê¹€

            // ê²€ìƒ‰ ê²°ê³¼ ì´ˆê¸°í™” (ì „ì²´ ëª©ë¡ í‘œì‹œ)
            searchItems();
            
            // í…ìŠ¤íŠ¸ í•„ë“œì— í¬ì»¤ìŠ¤
            searchInput.focus();
        }

        // ê²€ìƒ‰ í•¨ìˆ˜ (ì…ë ¥ ê°’ ë³€ê²½ ì‹œ X ë²„íŠ¼ í‘œì‹œ ì—¬ë¶€ ì²˜ë¦¬ ì¶”ê°€)
        function searchItems() {
            const searchInput = document.getElementById('searchInput');
            const clearBtn = document.getElementById('clearSearchBtn');
            const searchTerm = searchInput.value.trim().toLowerCase();
            
            // í…ìŠ¤íŠ¸ê°€ ìˆì„ ë•Œë§Œ X ë²„íŠ¼ í‘œì‹œ
            if (searchTerm.length > 0) {
                clearBtn.style.display = 'block';
            } else {
                clearBtn.style.display = 'none';
            }

            // ê´€ë¦¬ìê°€ ì•„ë‹ ê²½ìš° 'ìŠ¹ì¸ ëŒ€ê¸°' ë¬¼í’ˆì€ ê²€ìƒ‰ ëŒ€ìƒì—ì„œ ì œì™¸ (renderItemsì—ì„œ ìµœì¢… í•„í„°ë§ë˜ì§€ë§Œ ì—¬ê¸°ì„œë„ í•œë²ˆ ì œì™¸í•˜ì—¬ íš¨ìœ¨í™”)
            let searchTargetItems = items.filter(item => item.status !== 'ìŠ¹ì¸ ëŒ€ê¸°');
            if(isAdmin) {
                searchTargetItems = items; // ê´€ë¦¬ìëŠ” ëª¨ë‘ ê²€ìƒ‰ ê°€ëŠ¥
            }

            const filteredItems = searchTargetItems.filter(item => 
                item.name.toLowerCase().includes(searchTerm) || 
                item.description.toLowerCase().includes(searchTerm)
            );
            
            renderItems(filteredItems);
        }

        document.getElementById('searchInput').addEventListener('input', searchItems);

        // --- ê´€ë¦¬ì ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ---
        // ì œëª© 3íšŒ í´ë¦­ìœ¼ë¡œ ì§ì ‘ í˜¸ì¶œë¨
        function loginAdmin() {
            const deptCode = prompt(`ê´€ë¦¬ì ë¶€ì„œ ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”. (${departments.join(', ')} ì¤‘ í•˜ë‚˜)`);
            if (deptCode === null) return;

            const password = prompt(`[${deptCode}] ê´€ë¦¬ìì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”. (ë¶€ì„œë³„ ë¹„ë°€ë²ˆí˜¸ ì˜ˆ: 1ë¶€: dept1, 2ë¶€: dept2)`);
            if (password === null) return;
            
            const expectedPassword = adminPasswords[deptCode];

            if (expectedPassword && password === expectedPassword) {
                isAdmin = true;
                adminDept = deptCode; // ë¡œê·¸ì¸ëœ ë¶€ì„œ ì €ì¥
                alert(`${adminDept} ê´€ë¦¬ì ë¡œê·¸ì¸ ì„±ê³µ.`);
                showPage('main'); // ë¡œê·¸ì¸ í›„ ë©”ì¸ ëª©ë¡ ìƒˆë¡œê³ ì¹¨ ë° ë²„íŠ¼ ì—…ë°ì´íŠ¸
            } else {
                alert('ë¶€ì„œ ì½”ë“œ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
            }
        }

        function logoutAdmin() {
            isAdmin = false;
            adminDept = null; // ë¶€ì„œ ì •ë³´ ì´ˆê¸°í™”
            showPage('main'); // ë¡œê·¸ì•„ì›ƒ í›„ ë©”ì¸ ëª©ë¡ìœ¼ë¡œ ì´ë™ (í‘¸í„° ìˆ¨ê¹€ ì²˜ë¦¬ë¨)
        }

        // --- ë¬¼í’ˆ ì‹ ì²­ í•¨ìˆ˜ ---
        function applyForItem(itemId) {
            const item = items.find(i => i.id === itemId);
            const applyName = document.getElementById('applyName').value.trim();
            const applyDept = document.getElementById('applyDept').value.trim();
            const applyTeam = document.getElementById('applyTeam').value.trim();
            const applyId = document.getElementById('applyId').value.trim();
            const applyDescription = document.getElementById('applyDescription').value.trim();
            
            if (!applyName || !applyDept || !applyTeam || !applyId || !applyDescription) {
                alert('ì‹ ì²­ì ì •ë³´ ë° ì‚¬ìœ ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            if (!item || item.status !== 'íŒë§¤ ì¤‘') {
                 alert('ì‹ ì²­ ê°€ëŠ¥í•œ ë¬¼í’ˆì´ ì•„ë‹™ë‹ˆë‹¤.');
                 return;
            }

            const applyInfo = { name: applyName, dept: applyDept, team: applyTeam, id: applyId, reason: applyDescription };
            
            // [ì¶”ê°€] ê³ ìœ ë²ˆí˜¸ A111ì´ ì´ë¯¸ ì˜ˆì•½ì¤‘ì¸ ë‹¤ë¥¸ ë¬¼í’ˆì— ìˆëŠ”ì§€ í™•ì¸ (í…ŒìŠ¤íŠ¸ìš©)
            const existingBuyer = items.find(i => 
                i.id !== itemId && 
                i.status === 'ì˜ˆì•½ì¤‘' && 
                i.historyBuyerInfo && i.historyBuyerInfo.id === applyInfo.id 
            );

            if (existingBuyer) {
                alert(`ì´ë¯¸ ë‹¤ë¥¸ ë¬¼í’ˆì— ì‹ ì²­(ì˜ˆì•½) ì¤‘ì´ë¯€ë¡œ ì‹ ì²­í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
                return;
            }

            item.status = 'ì˜ˆì•½ì¤‘';
            item.historyStatus = 'ì‹ ì²­ ì¤‘';
            item.historyBuyerInfo = applyInfo; 
            
            alert(`ë¬¼í’ˆ [${item.name}]ì— ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë¬¼í’ˆ ë“±ë¡ì ë¶€ì„œ(${item.requesterInfo.dept}) ê´€ë¦¬ìì˜ 1ë‹¨ê³„ ì‹ ì²­ ìŠ¹ì¸ì„ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.`);
            showPage('main');
        }


        // ê´€ë¦¬ì ê¶Œí•œ í™•ì¸ í•¨ìˆ˜ (2ë‹¨ê³„ ìŠ¹ì¸ ë¡œì§ ë°˜ì˜)
        function checkAdminAuth(item, actionType) {
            if (!isAdmin) return false;

            // 1. ë“±ë¡ ìŠ¹ì¸, ìˆ˜ì •, ì‚­ì œëŠ” ë“±ë¡ì ë¶€ì„œ ê´€ë¦¬ì ë‹´ë‹¹
            if (actionType === 'register_approve' || actionType === 'delete' || actionType === 'edit') {
                return adminDept === item.requesterInfo.dept;
            }
            
            // 2. 1ë‹¨ê³„: ì‹ ì²­ ìŠ¹ì¸/ê±°ì ˆì€ ë“±ë¡ì ë¶€ì„œ ê´€ë¦¬ì ë‹´ë‹¹
            else if (actionType === 'trade_approve') {
                return adminDept === item.requesterInfo.dept;
            }
            
            // 3. 2ë‹¨ê³„: ê±°ë˜ ì™„ë£Œ/ì˜ˆì•½ ì·¨ì†ŒëŠ” ì‹ ì²­ì ë¶€ì„œ ê´€ë¦¬ì ë‹´ë‹¹
            else if (actionType === 'trade_confirm') {
                // ì‹ ì²­ìê°€ ì—†ëŠ” ê²½ìš° (historyBuyerInfoê°€ null)ì—ëŠ” ê±°ë˜ ì™„ë£Œ ì²˜ë¦¬ê°€ ë¶ˆê°€ëŠ¥í•˜ë¯€ë¡œ false ë°˜í™˜
                if (!item.historyBuyerInfo) return false; 
                return adminDept === item.historyBuyerInfo.dept;
            }

            return false;
        }


        // --- ê´€ë¦¬ì ëª©ë¡ ê´€ë ¨ í•¨ìˆ˜ (ë¶€ì„œ ê¶Œí•œ ì²´í¬ ì ìš©) ---
        function renderAdminList() {
            if (!isAdmin) return;
            
            const listContainer = document.getElementById('adminListContainer');
            listContainer.innerHTML = '';
            
            // ì œëª© ìˆ˜ì •
            document.querySelector('#adminListPage h2').textContent = 'ğŸš¨ ê´€ë¦¬ ëª©ë¡';
            
            // 'ìŠ¹ì¸ ëŒ€ê¸°' ë˜ëŠ” 'ì˜ˆì•½ì¤‘'ì¸ í•­ëª©ë§Œ í•„í„°ë§
            const adminItems = items.filter(item => 
                item.status === 'ìŠ¹ì¸ ëŒ€ê¸°' || item.status === 'ì˜ˆì•½ì¤‘'
            );

            if (adminItems.length === 0) {
                listContainer.innerHTML = '<p style="text-align: center; color: #555; padding: 20px; margin: 0;">í˜„ì¬ ê´€ë¦¬ ëŒ€ê¸° ì¤‘ì¸ ë¬¼í’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            adminItems.forEach(item => {
                let actions = '';
                let displayStatus = '';
                let requiredDept = '';

                // ê¶Œí•œ í™•ì¸
                const canApproveRegister = checkAdminAuth(item, 'register_approve');
                const canApproveTrade = checkAdminAuth(item, 'trade_approve');
                const canConfirmTrade = checkAdminAuth(item, 'trade_confirm');

                // ì‹ ì²­ì ì •ë³´ ì–‘ì‹ ë³€ê²½
                let buyerInfoDisplay = '';
                if (item.historyBuyerInfo) {
                    const info = item.historyBuyerInfo;
                    buyerInfoDisplay = `
                        <div class="admin-info">
                            <strong>ì‹ ì²­ ë¶€ì„œ: ${info.dept}</strong> | ì‹ ì²­ì: ${info.name} (${info.id}) <br>
                            ì‹ ì²­ ì‚¬ìœ : ${info.reason || 'ì •ë³´ ì—†ìŒ'}
                        </div>
                    `;
                }

                if (item.status === 'ìŠ¹ì¸ ëŒ€ê¸°') {
                    // ë“±ë¡ ìŠ¹ì¸
                    displayStatus = 'ë“±ë¡ ìŠ¹ì¸ ëŒ€ê¸°';
                    requiredDept = item.requesterInfo.dept;

                    if (canApproveRegister) {
                         actions = `
                            <button class="admin-action-btn approve-btn" onclick="approveItem(${item.id})">âœ… ë“±ë¡ ìŠ¹ì¸</button>
                            <button class="admin-action-btn delete-btn" onclick="deleteItem(${item.id})">ğŸ—‘ï¸ ë“±ë¡ ê±°ì ˆ/ì‚­ì œ</button>
                        `;
                    } else {
                        actions = `<button class="admin-action-btn approve-btn disabled-btn">âŒ ê¶Œí•œ ì—†ìŒ</button>`;
                        displayStatus += ` <span class="unauthorized">(ë‹´ë‹¹: ${requiredDept})</span>`;
                    }
                    
                } else if (item.status === 'ì˜ˆì•½ì¤‘') {
                    if (item.historyStatus === 'ì‹ ì²­ ì¤‘') {
                        // 1ë‹¨ê³„: ë“±ë¡ì ë¶€ì„œ ê´€ë¦¬ìê°€ ì‹ ì²­ ìŠ¹ì¸
                        displayStatus = '1ì°¨ ëŒ€ê¸° (ì‹ ì²­ ìŠ¹ì¸)';
                        requiredDept = item.requesterInfo.dept;

                        if(canApproveTrade) {
                             actions = `
                                <button class="admin-action-btn approve-trade-btn" onclick="approveTrade(${item.id})">âœ… 1ì°¨ ì‹ ì²­ ìŠ¹ì¸</button>
                                <button class="admin-action-btn cancel-trade-btn" onclick="cancelTradeByAdmin(${item.id})">âŒ ì‹ ì²­ ê±°ì ˆ</button>
                            `;
                        } else {
                            actions = `<button class="admin-action-btn approve-trade-btn disabled-btn">âŒ ê¶Œí•œ ì—†ìŒ</button>`;
                            displayStatus += ` <span class="unauthorized">(ë‹´ë‹¹: ${requiredDept})</span>`;
                        }

                    } else if (item.historyStatus === 'ì˜ˆì•½ ìŠ¹ì¸') {
                        // 2ë‹¨ê³„: ì‹ ì²­ì ë¶€ì„œ ê´€ë¦¬ìê°€ ê±°ë˜ ì™„ë£Œ ì²˜ë¦¬ (ìˆ˜ë ¹ í™•ì¸)
                        displayStatus = '2ì°¨ ëŒ€ê¸° (ê±°ë˜ ì™„ë£Œ)';
                        requiredDept = item.historyBuyerInfo ? item.historyBuyerInfo.dept : 'ì‹ ì²­ì ì—†ìŒ';

                        if(canConfirmTrade) {
                             actions = `
                                <button class="admin-action-btn confirm-trade-btn" onclick="confirmTrade(${item.id})">ğŸ“¦ 2ì°¨ ê±°ë˜ ì™„ë£Œ</button>
                                <button class="admin-action-btn cancel-trade-btn" onclick="cancelTradeByAdmin(${item.id})">ğŸš« ì˜ˆì•½ ì·¨ì†Œ</button>
                            `;
                        } else {
                            actions = `<button class="admin-action-btn confirm-trade-btn disabled-btn">âŒ ê¶Œí•œ ì—†ìŒ</button>`;
                            displayStatus += ` <span class="unauthorized">(ë‹´ë‹¹: ${requiredDept})</span>`;
                        }
                    } else {
                        displayStatus = 'ì˜ˆì•½ì¤‘ (ìƒíƒœ ì˜¤ë¥˜)';
                    }
                }


                const isNoImage = !isValidImageUrl(item.imageUrl);
                const displayImageUrl = isNoImage ? THUMBNAIL_PLACEHOLDER : item.imageUrl;
                let thumbnailHtml = '';

                if (isNoImage) {
                    thumbnailHtml = `<div class="item-thumbnail-wrapper">${NO_IMAGE_TEXT}</div>`;
                } else {
                    thumbnailHtml = `<div class="item-thumbnail-wrapper"><img src="${displayImageUrl}" alt="${item.name} ì´ë¯¸ì§€" class="item-thumbnail"></div>`;
                }


                const card = document.createElement('div');
                card.classList.add('item-card', 'admin-card');
                card.style.cursor = 'default';
                card.innerHTML = `
                    ${thumbnailHtml}
                    <div class="item-content">
                        <div class="item-header">
                            <span class="item-name" title="${item.name}">${item.name}</span>
                            <span class="item-status ${getStatusClass(item.status)}">${displayStatus}</span>
                        </div>
                        <div class="item-info">
                            ì¹´í…Œê³ ë¦¬: ${item.category || 'ë¯¸ë¶„ë¥˜'} | ë“±ë¡ì¼: ${item.registerDate || '-'} | ë“±ë¡ì: ${item.requesterInfo.name} (${item.requesterInfo.dept})
                        </div>
                        ${buyerInfoDisplay}
                        <div class="item-actions" style="margin-top: 10px;">
                            ${actions}
                        </div>
                    </div>
                `;
                listContainer.appendChild(card);
            });
        }
        
        // ê´€ë¦¬ ëª©ë¡ í˜ì´ì§€ ì§„ì… ì‹œ ìë™ìœ¼ë¡œ ì‹¤í–‰ë˜ì–´ ë²„íŠ¼ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
        function updateAdminButtonStatus() {
             // ê´€ë¦¬ ëª©ë¡ í˜ì´ì§€ê°€ ì•„ë‹Œ ê²½ìš° ë™ì‘í•˜ì§€ ì•ŠìŒ
             if (document.getElementById('adminListPage').style.display !== 'block') return;
             
             // ê´€ë¦¬ ëª©ë¡ì´ í‘œì‹œë  ë•Œë§Œ ëª©ë¡ì„ ë‹¤ì‹œ ë Œë”ë§
             if (isAdmin) {
                 renderAdminList();
             }
        }


        // --- ê´€ë¦¬ì ì•¡ì…˜ (ê¶Œí•œ í™•ì¸ ë¡œì§ ì¶”ê°€) ---

        // 1ë‹¨ê³„: ì‹ ì²­ ìŠ¹ì¸ (ë“±ë¡ì ë¶€ì„œ ê´€ë¦¬ì ë‹´ë‹¹)
        function approveTrade(itemId) {
            const item = items.find(i => i.id === itemId);
            if (!item) return;

            if (!checkAdminAuth(item, 'trade_approve')) {
                alert(`ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ì´ ë¬¼í’ˆì˜ 1ì°¨ ì‹ ì²­ ìŠ¹ì¸ì€ ë“±ë¡ì ë¶€ì„œ (${item.requesterInfo.dept}) ê´€ë¦¬ìë§Œ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
                return;
            }

            // ìƒíƒœ í™•ì¸: ì‹ ì²­ ì¤‘ ìƒíƒœì¼ ë•Œë§Œ ìŠ¹ì¸ ê°€ëŠ¥
            if (item && item.status === 'ì˜ˆì•½ì¤‘' && item.historyStatus === 'ì‹ ì²­ ì¤‘') {
                item.historyStatus = 'ì˜ˆì•½ ìŠ¹ì¸';
                alert(`${item.name}ì˜ ì‹ ì²­ì´ 1ì°¨ ìŠ¹ì¸ë˜ì–´ 'ì˜ˆì•½ í™•ì • (2ì°¨ ëŒ€ê¸°)' ìƒíƒœë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                showPage('adminListPage');
            } else {
                alert('ì˜ëª»ëœ ìƒíƒœì…ë‹ˆë‹¤. ì‹ ì²­ ëŒ€ê¸° ë¬¼í’ˆë§Œ 1ì°¨ ì‹ ì²­ ìŠ¹ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
            }
        }

        // ì˜ˆì•½/ê±°ë˜ ì·¨ì†Œ (1ë‹¨ê³„/2ë‹¨ê³„ ëª¨ë‘ ê°€ëŠ¥, ë“±ë¡ì ë¶€ì„œ ê´€ë¦¬ìê°€ ì‹ ì²­/ì˜ˆì•½ ìƒíƒœì— ê´€ê³„ì—†ì´ ì·¨ì†Œ ê°€ëŠ¥)
        function cancelTradeByAdmin(itemId) {
            const item = items.find(i => i.id === itemId);
            if (!item) return;

             // ë“±ë¡ì ë¶€ì„œ ê´€ë¦¬ìë§Œ ì·¨ì†Œ ê°€ëŠ¥
            if (!checkAdminAuth(item, 'trade_approve') && !checkAdminAuth(item, 'register_approve')) {
                alert(`ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ì´ ë¬¼í’ˆì˜ ì·¨ì†Œ/ê±°ì ˆ ì²˜ë¦¬ëŠ” ë“±ë¡ì ë¶€ì„œ (${item.requesterInfo.dept}) ê´€ë¦¬ìë§Œ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
                return;
            }

            if (item && item.status === 'ì˜ˆì•½ì¤‘') {
                const buyerDept = item.historyBuyerInfo ? item.historyBuyerInfo.dept : 'ì‹ ì²­ì ì—†ìŒ';
                if (confirm(`ì •ë§ë¡œ ë¬¼í’ˆ [${item.name}]ì˜ ì‹ ì²­/ì˜ˆì•½ì„ ì·¨ì†Œí•˜ê³  'íŒë§¤ ì¤‘' ìƒíƒœë¡œ ë˜ëŒë¦¬ê² ìŠµë‹ˆê¹Œ? (í˜„ì¬ ì‹ ì²­ì: ${item.historyBuyerInfo ? item.historyBuyerInfo.name : 'ì—†ìŒ'})`)) {
                    item.status = 'íŒë§¤ ì¤‘';
                    item.historyStatus = 'ì‹ ì²­ ì—†ìŒ';
                    item.historyBuyerInfo = null; // ì‹ ì²­ì ì •ë³´ ì‚­ì œ
                    alert(`${item.name}ì˜ ì˜ˆì•½/ì‹ ì²­ì´ ì·¨ì†Œë˜ê³  'íŒë§¤ ì¤‘' ìƒíƒœë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                    showPage('adminListPage');
                }
            } else if (item && item.status === 'ìŠ¹ì¸ ëŒ€ê¸°') {
                // ë“±ë¡ ê±°ì ˆ ì‹œì—ëŠ” ì‚­ì œ ë¡œì§ìœ¼ë¡œ ì²˜ë¦¬
                deleteItem(itemId);
            }
        }

        // 2ë‹¨ê³„: ê±°ë˜ ì™„ë£Œ (ì‹ ì²­ì ë¶€ì„œ ê´€ë¦¬ì ë‹´ë‹¹)
        function confirmTrade(itemId) {
            const item = items.find(i => i.id === itemId);
            if (!item) return;

            if (!checkAdminAuth(item, 'trade_confirm')) {
                alert(`ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ì´ ê±°ë˜ì˜ 2ì°¨ ì™„ë£Œ ì²˜ë¦¬ëŠ” ì‹ ì²­ì ë¶€ì„œ (${item.historyBuyerInfo ? item.historyBuyerInfo.dept : 'ì‹ ì²­ì ì—†ìŒ'}) ê´€ë¦¬ìë§Œ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
                return;
            }

            // ìƒíƒœ í™•ì¸: ì˜ˆì•½ ìŠ¹ì¸ ìƒíƒœì¼ ë•Œë§Œ ì™„ë£Œ ê°€ëŠ¥
            if (item && item.status === 'ì˜ˆì•½ì¤‘' && item.historyStatus === 'ì˜ˆì•½ ìŠ¹ì¸') {
                item.status = 'ê±°ë˜ ì™„ë£Œ';
                item.historyStatus = 'ê±°ë˜ í™•ì •';
                alert(`${item.name}ì˜ ê±°ë˜ê°€ 2ì°¨ ìŠ¹ì¸ë˜ì–´ ìµœì¢… 'ë‚˜ëˆ” ì™„ë£Œ' ìƒíƒœë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                showPage('adminListPage');
            } else {
                alert('ì˜ëª»ëœ ìƒíƒœì…ë‹ˆë‹¤. 1ì°¨ ì˜ˆì•½ ìŠ¹ì¸ëœ ë¬¼í’ˆë§Œ 2ì°¨ ë‚˜ëˆ” ì™„ë£Œ ì²˜ë¦¬ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
            }
        }

        // --- ê¸°íƒ€ ê´€ë¦¬ì ì•¡ì…˜ (ë“±ë¡ ìŠ¹ì¸, ì‚­ì œ) ---
        function approveItem(itemId) {
            const item = items.find(i => i.id === itemId);
            if (!item) return;

            if (!checkAdminAuth(item, 'register_approve')) {
                alert(`ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ì´ ë“±ë¡ì€ ${item.requesterInfo.dept} ê´€ë¦¬ìë§Œ ìŠ¹ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
                return;
            }
            
            if (item && item.status === 'ìŠ¹ì¸ ëŒ€ê¸°') {
                item.status = 'íŒë§¤ ì¤‘';
                alert(`${item.name} ë¬¼í’ˆì´ ëª©ë¡ì— ë“±ë¡(ìŠ¹ì¸)ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                showPage('adminListPage');
            }
        }

        // ğŸš€ [ìˆ˜ì •] ì‚­ì œ ê¸°ëŠ¥ ë° ê¶Œí•œ ê°•í™”
        function deleteItem(itemId) {
            const item = items.find(i => i.id === itemId);
            if (!item) return;

            // ê´€ë¦¬ì ë¶€ì„œì™€ ë“±ë¡ì ë¶€ì„œê°€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
            if (!isAdmin || adminDept !== item.requesterInfo.dept) {
                alert(`ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ì´ ë¬¼í’ˆì€ ${item.requesterInfo.dept} ê´€ë¦¬ìë§Œ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
                return;
            }

            // ğŸš€ [ì¶”ê°€] ì‚­ì œ ìµœì¢… í™•ì¸ì°½
            if (confirm(`ì •ë§ë¡œ ì´ ë¬¼í’ˆ (${item.name})ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) {
                const index = items.findIndex(i => i.id === itemId);
                if (index > -1) {
                    items.splice(index, 1);
                    alert(`ë¬¼í’ˆ [${item.name}]ì´(ê°€) ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
                    // í˜„ì¬ í˜ì´ì§€ê°€ ê´€ë¦¬ ëª©ë¡ì´ë©´ ìƒˆë¡œê³ ì¹¨
                    if (document.getElementById('adminListPage').style.display === 'block') {
                        showPage('adminListPage');
                    } else {
                        showPage('main');
                    }
                }
            }
        }

        // --- ìˆ˜ì • ê¸°ëŠ¥ (ê´€ë¦¬ì ì „ìš©, ê¶Œí•œ í™•ì¸ ë¡œì§ ì¶”ê°€) ---
        function editItem(itemId) {
            const item = items.find(i => i.id === itemId);
            
            // ìˆ˜ì • ê¶Œí•œë„ ë“±ë¡ì ë¶€ì„œ ê´€ë¦¬ìì—ê²Œë§Œ ë¶€ì—¬
            if (!checkAdminAuth(item, 'edit')) {
                alert(`ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ì´ ë¬¼í’ˆì€ ${item.requesterInfo.dept} ê´€ë¦¬ìë§Œ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
                return;
            }
            
            if (!item) return;

            const newName = prompt(`[${item.name}]ì˜ ìƒˆ ë¬¼í’ˆ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:`, item.name);
            if (newName === null) return;
            const newDescription = prompt(`[${item.name}]ì˜ ìƒˆ ìƒì„¸ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”:`, item.description);
            if (newDescription === null) return;
            
            const categoryPrompt = `[${item.name}]ì˜ ìƒˆ ì¹´í…Œê³ ë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš” (í˜„ì¬: ${item.category})\n\nì„ íƒ ê°€ëŠ¥í•œ ì¹´í…Œê³ ë¦¬: ${categories.join(', ')}\nìƒˆ ì¹´í…Œê³ ë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”:`;
            let newCategory = item.category;
            let inputCategory = prompt(categoryPrompt, item.category);

            if (inputCategory === null) return;
            if (categories.includes(inputCategory.trim())) {
                 newCategory = inputCategory.trim();
            } else {
                 alert('ìœ íš¨í•˜ì§€ ì•Šì€ ì¹´í…Œê³ ë¦¬ì…ë‹ˆë‹¤. ê¸°ì¡´ ì¹´í…Œê³ ë¦¬ê°€ ìœ ì§€ë©ë‹ˆë‹¤.');
            }

            // ë“±ë¡ì ì •ë³´ ìˆ˜ì • (í•„ìš”í•œ ê²½ìš°)
            const newRName = prompt(`[${item.name}] ë“±ë¡ì ì´ë¦„ (í˜„ì¬: ${item.requesterInfo.name}):`, item.requesterInfo.name);
            if (newRName === null) return;
            
            let newRDept = item.requesterInfo.dept; 
            const deptPrompt = `[${item.name}] ë“±ë¡ì ë¶€ì„œë¥¼ ì…ë ¥í•˜ì„¸ìš” (í˜„ì¬: ${item.requesterInfo.dept})\n\nì„ íƒ ê°€ëŠ¥í•œ ë¶€ì„œ: ${departments.join(', ')}\nìƒˆ ë¶€ì„œë¥¼ ì…ë ¥í•˜ì„¸ìš”:`;
            let inputDept = prompt(deptPrompt, item.requesterInfo.dept);

            if (inputDept === null) return;
            if (departments.includes(inputDept.trim())) {
                 newRDept = inputDept.trim();
            } else {
                 alert('ìœ íš¨í•˜ì§€ ì•Šì€ ë¶€ì„œì…ë‹ˆë‹¤. ê¸°ì¡´ ë¶€ì„œê°€ ìœ ì§€ë©ë‹ˆë‹¤.');
            }

            const newRTeam = prompt(`[${item.name}] ë“±ë¡ì íŒ€ (í˜„ì¬: ${item.requesterInfo.team}):`, item.requesterInfo.team);
            if (newRTeam === null) return;
            const newRId = prompt(`[${item.name}] ë“±ë¡ì ê³ ìœ ë²ˆí˜¸ (í˜„ì¬: ${item.requesterInfo.id}):`, item.requesterInfo.id);
            if (newRId === null) return;

            const newImageUrl = prompt(`[${item.name}]ì˜ ìƒˆ ì´ë¯¸ì§€ URLì„ ì…ë ¥í•˜ì„¸ìš” (ë³€ê²½í•˜ì§€ ì•Šìœ¼ë ¤ë©´ ê³µë°±):`, item.imageUrl);
            
            item.name = newName.trim();
            item.description = newDescription.trim();
            item.category = newCategory.trim();
            item.requesterInfo.name = newRName.trim();
            item.requesterInfo.dept = newRDept.trim(); 
            item.requesterInfo.team = newRTeam.trim();
            item.requesterInfo.id = newRId.trim();
            
            // ì´ë¯¸ì§€ URL ì²˜ë¦¬: ì‚¬ìš©ìê°€ ê³µë°±ì„ ì…ë ¥í•˜ë©´ ê¸°ì¡´ URL ìœ ì§€, ëª…ì‹œì  URLì„ ì…ë ¥í•˜ë©´ ì—…ë°ì´íŠ¸.
            // ë‹¤ë§Œ, íŒŒì¼ ì—…ë¡œë“œ í•„ë“œê°€ ì—†ìœ¼ë¯€ë¡œ URLë¡œë§Œ ì²˜ë¦¬í•©ë‹ˆë‹¤.
            if (newImageUrl !== null) {
                 item.imageUrl = newImageUrl.trim();
            }


            alert(`ë¬¼í’ˆ [${item.name}]ì˜ ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            // í˜„ì¬ í˜ì´ì§€ê°€ ê´€ë¦¬ ëª©ë¡ì´ë©´ ìƒˆë¡œê³ ì¹¨
            if (document.getElementById('adminListPage').style.display === 'block') {
                 showPage('adminListPage');
            } else {
                 showPage('main');
            }
        }
    </script>
</body>
</html>
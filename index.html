<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¬´ë£Œ ë‚˜ëˆ” ê²Œì‹œíŒ (ë°ê³  ì‹¬í”Œí•œ í…Œë§ˆ)</title>
    
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa; 
            margin: 0;
            padding: 20px; 
            line-height: 1.6;
        }

        .container {
            max-width: 1000px; 
            margin: auto;
            background: #ffffff; 
            padding: 25px;
            border-radius: 12px; 
            box-shadow: 0 8px 16px rgba(0,0,0,0.1); 
            position: relative;
            min-height: 80vh; 
        }

        h1 {
            color: #34495e; 
            border-bottom: 3px solid #3498db; 
            padding-bottom: 10px;
            margin-bottom: 20px; 
            font-size: 1.8em; 
            font-weight: 600;
        }
        
        /* --- ê²€ìƒ‰ì°½ ìŠ¤íƒ€ì¼ --- */
        .search-box {
            position: relative;
            width: 100%;
            margin-bottom: 20px;
        }

        #searchInput {
            width: 100%;
            padding: 10px 35px 10px 10px; 
            box-sizing: border-box; 
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 0.95em;
        }

        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #95a5a6; 
            pointer-events: none; 
            font-size: 1.2em;
        }
        
        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        footer button, .form-actions button, #mainContent .action-group button { 
            background-color: #e9ecef; 
            color: #34495e;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            margin-left: 5px; 
            font-size: 0.9em; 
            transition: all 0.2s;
            white-space: nowrap;
        }

        footer button:hover, .form-actions button:hover, #mainContent .action-group button:hover {
            background-color: #dee2e6;
        }
        
        .status-message.buyer { color: #3498db; font-weight: 600; }

        /* ë“±ë¡ ë° ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
        #buttonContainer {
            margin: 15px 0;
            text-align: right;
            display: flex;
            justify-content: flex-end;
            gap: 10px; /* ë²„íŠ¼ ê·¸ë£¹ ì‚¬ì´ ê°„ê²© */
        }
        
        .action-group {
            display: flex;
            gap: 5px;
        }

        /* ë“±ë¡ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        #registerButtonContainer button {
            background-color: #27ae60; 
            color: white;
            padding: 10px 15px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(39, 174, 96, 0.3);
            margin-left: 0; 
        }
        
        #registerButtonContainer button:hover {
            background-color: #2ecc71;
        }
        
        /* ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        #categoryButton {
            background-color: #f39c12; 
            color: white;
            padding: 10px 15px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(243, 156, 18, 0.3);
            margin-left: 0;
        }
        
        #categoryButton:hover {
            background-color: #f1c40f;
        }

        /* --- ì•„ì´í…œ ë¦¬ìŠ¤íŠ¸ (ê³µí†µ ì¹´ë“œ êµ¬ì¡°) ìŠ¤íƒ€ì¼ --- */
        
        .list-container {
            display: flex;
            flex-direction: column;
            gap: 15px; 
            margin-top: 15px;
        }
        
        #adminListPage .list-container {
             margin-top: 25px;
             border: 2px solid #e74c3c; 
             border-radius: 10px;
             padding: 15px;
             background-color: #fef5f4; 
        }

        /* ê°œë³„ ì•„ì´í…œ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .item-card {
            display: flex; 
            align-items: flex-start; 
            padding: 15px;
            border: 1px solid #ecf0f1;
            border-radius: 8px;
            background-color: #ffffff;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            cursor: pointer;
            transition: background-color 0.2s;
            position: relative;
        }

        .item-card:hover {
            background-color: #f5f5f5;
        }

        /* ì¸ë„¤ì¼ Wrapper: í¬ê¸° ê³ ì • ë° í…ìŠ¤íŠ¸ ë°€ë¦¼ ë°©ì§€ (ìˆ˜ì •ë¨) */
        .item-thumbnail-wrapper {
            width: 60px; /* ë„ˆë¹„ ê³ ì • */
            height: 60px; /* ë†’ì´ ê³ ì • */
            min-width: 60px; /* ìµœì†Œ ë„ˆë¹„ë„ 60pxë¡œ ê³ ì • */
            border-radius: 8px;
            overflow: hidden;
            margin-right: 15px;
            border: 1px solid #bdc3c7;
            flex-shrink: 0; /* ê³µê°„ì´ ë¶€ì¡±í•´ë„ ì¤„ì–´ë“¤ì§€ ì•ŠìŒ */
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #ecf0f1;
            font-size: 0.7em;
            color: #7f8c8d;
        }
        
        .item-thumbnail {
            width: 100%;
            height: 100%;
            object-fit: cover; 
            border-radius: 8px;
            border: none; 
        }

        /* í…ìŠ¤íŠ¸ ì»¨í…ì¸  ì˜ì—­ */
        .item-content {
            flex-grow: 1;
            min-width: 0; /* flex ì•„ì´í…œì´ ì˜¤ë²„í”Œë¡œìš°ë¥¼ ë§‰ë„ë¡ ìµœì†Œ ë„ˆë¹„ë¥¼ 0ìœ¼ë¡œ ì„¤ì • */
        }
        
        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 5px;
        }
        
        /* ê´€ë¦¬ì ëª©ë¡: ì´ë¦„ê³¼ ìƒíƒœë¥¼ ì„¸ë¡œë¡œ ë°°ì¹˜í•˜ê¸° ìœ„í•œ ì¡°ì • */
        .admin-card .item-header {
            display: block; 
            margin-bottom: 0;
        }
        .admin-card .item-name {
            display: block; 
            margin-right: 0;
            margin-bottom: 5px; 
            white-space: normal; 
            overflow: visible; 
            text-overflow: clip;
        }
        .admin-card .item-status {
             display: block; 
             margin-bottom: 5px;
        }

        /* ë¶€ì„œ ë¶ˆì¼ì¹˜ ì‹œ ìƒíƒœ ìŠ¤íƒ€ì¼ */
        .admin-card .unauthorized {
            color: #e74c3c;
            font-weight: 500;
        }


        .item-name {
            font-weight: 700;
            color: #34495e;
            font-size: 1.1em;
            /* ğŸš€ ê¸€ì ë°€ë¦¼ ë°©ì§€ ë° ë§ì¤„ì„í‘œ ì²˜ë¦¬ */
            max-width: 70%; 
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap; 
            margin-right: 10px;
        }

        /* ì•„ì´í…œ ìƒíƒœ ë° ê¸°íƒ€ ì •ë³´ */
        .item-info {
            font-size: 0.85em;
            color: #7f8c8d;
            margin-bottom: 5px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .item-actions {
            margin-top: 8px;
            display: flex;
            flex-wrap: wrap; 
            gap: 5px; 
        }

        /* ë””í…Œì¼ ë‚´ìš© (DIV í˜•íƒœë¡œ ë³€ê²½ë¨) */
        .detail-row {
            display: none;
            width: 100%;
            background-color: #ecf0f1; 
            padding: 15px;
            border-radius: 8px;
            margin-top: -10px; 
            border: 1px dashed #ccc;
            border-top: none; 
            box-sizing: border-box;
        }

        /* ìƒì„¸ ì´ë¯¸ì§€ ì˜ì—­ ìŠ¤íƒ€ì¼ ì¡°ì • */
        .detail-image-box {
            text-align: center;
            margin: 10px auto 15px auto;
            max-width: 100%; 
            height: auto;
            border-radius: 8px;
            border: 1px solid #ccc;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            background-color: #ecf0f1;
            display: block;
            padding: 0;
            overflow: hidden;
        }

        /* ì´ë¯¸ì§€ ìì²´ì— ì ìš©í•˜ì—¬ ìµœëŒ€ ë„ˆë¹„ ë³´ì¥ */
        .detail-image-box img {
            max-width: 100%; 
            height: auto; 
            display: block;
        }
        
        .detail-image-box.no-image {
            width: 100%;
            max-width: 250px;
            height: 150px; 
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1em;
            color: #7f8c8d;
            font-weight: bold;
        }

        /* ì•¡ì…˜ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .admin-action-btn, .action-btn {
            padding: 8px 12px;
            margin: 0; 
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
            font-weight: 500;
        }
        
        .trade-apply-btn { background-color: #3498db; color: white; } 
        .approve-btn { background-color: #2ecc71; color: white; } 
        .approve-trade-btn { background-color: #1abc9c; color: white; } 
        .confirm-trade-btn { background-color: #9b59b6; color: white; } 
        .cancel-trade-btn { background-color: #e74c3c; color: white; } 
        .edit-btn { background-color: #f1c40f; color: #333; } 
        .delete-btn { background-color: #bdc3c7; color: #333; }
        
        /* ë¹„í™œì„±í™” ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .disabled-btn {
            background-color: #cccccc !important;
            color: #666666 !important;
            cursor: not-allowed !important;
            pointer-events: none;
            opacity: 0.6;
        }

        .cancel-btn { 
            background-color: #bdc3c7; 
            color: #333;
        }
        
        .cancel-btn:hover { background-color: #95a5a6; }

        .detail-content {
            padding: 15px;
            font-size: 0.9em; 
            color: #555;
        }
        
        /* ê´€ë¦¬ì ëª©ë¡ê³¼ êµ¬ë§¤ì ë‚´ì—­ ì „ìš© ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .admin-card {
            background-color: #fff8f8; 
        }
        .history-card {
            background-color: #f9fcff; 
            cursor: default; 
        }
        .history-card:hover {
            background-color: #f9fcff;
        }
        
        .admin-info {
            font-size: 0.8em;
            color: #7f8c8d;
            margin-top: 5px;
        }

        /* í‘¸í„° ìŠ¤íƒ€ì¼ */
        footer {
            max-width: 1000px;
            margin: 30px auto 0 auto;
            padding: 15px 25px;
            text-align: center;
            border-top: 1px solid #ecf0f1;
            background-color: #3498db; 
            color: white;
            border-radius: 12px;
            box-shadow: 0 -4px 8px rgba(0,0,0,0.1);
        }
        
        footer #adminListBtn { /* ê´€ë¦¬ì ëª©ë¡ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ìœ ì§€ */
            background-color: #e74c3c; 
            color: white;
            padding: 10px 18px;
            font-weight: bold;
            margin-right: 15px;
        }
        
        footer #adminListBtn:hover {
            background-color: #c0392b;
        }

        footer #adminLoginBtn {
            background-color: #e74c3c; 
            color: white;
            padding: 10px 18px;
            font-weight: bold;
        }
        
        footer #adminLoginBtn:hover {
            background-color: #c0392b;
        }
        
        /* ì•„ì´í…œ ë“±ë¡ í¼ ìŠ¤íƒ€ì¼ */
        #registrationFormPage, #itemDetailPage {
            padding: 20px;
            border: 1px solid #3498db;
            border-radius: 10px;
            background-color: #f9fcff;
        }

        #registrationFormPage h3, #itemDetailPage h3 {
            color: #34495e;
            border-bottom: 2px solid #bdc3c7;
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-size: 1.3em;
        }
        
        /* í¼ ìš”ì†Œ ê³µí†µ ìŠ¤íƒ€ì¼ */
        .form-content input[type="text"], .form-content select, .form-content textarea {
            width: 100%;
            padding: 10px;
            box-sizing: border-box; 
            border: 1px solid #ccc;
            border-radius: 6px;
            margin-bottom: 10px;
            font-size: 0.95em;
        }
        
        /* ë“±ë¡ì/ì‹ ì²­ì ì •ë³´ ì…ë ¥ë€ ê·¸ë£¹í™” */
        .info-group {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 10px;
            padding: 15px;
            border: 1px dashed #3498db;
            border-radius: 8px;
            background-color: #eef7ff; 
        }

        .form-label {
            display: block;
            font-size: 0.9em;
            color: #555;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        #itemImageFile {
            border: none;
            padding: 10px 0;
        }

        #itemDescription, #applyDescription {
            height: 120px; 
            resize: vertical;
        }

        .form-actions {
            margin-top: 20px;
        }
        
        /* ì¹´í…Œê³ ë¦¬ í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
        #categoryPage {
            padding: 20px;
        }
        
        .category-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr); 
            gap: 20px;
            margin-top: 20px;
        }
        
        .category-item {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100px;
            background-color: #ecf0f1;
            border-radius: 10px;
            font-weight: bold;
            color: #34495e;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
            font-size: 1.1em;
            text-align: center;
        }
        
        .category-item:hover {
            background-color: #bdc3c7;
            border-color: #3498db;
        }

        /* ì•„ì´í…œ ìƒíƒœë³„ ìƒ‰ìƒ */
        .status-waiting { color: #f39c12; font-weight: bold; } 
        .status-selling { color: #27ae60; font-weight: bold; } 
        .status-reserved { color: #8e44ad; font-weight: bold; } 
        .status-completed { color: #95a5a6; } 
        .status-cancelled { color: #e74c3c; font-weight: bold; } 
        
        /* --- ë¬¼í’ˆ ìƒì„¸ ë° ì‹ ì²­ í˜ì´ì§€ ìŠ¤íƒ€ì¼ --- */
        #itemDetailPage .item-detail-info {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        
        #itemDetailPage .image-container {
            flex-shrink: 0;
            width: 300px; 
            max-width: 40%;
            height: auto;
            border: 1px solid #ccc;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        #itemDetailPage .image-container img {
            width: 100%;
            height: auto;
            display: block;
        }
        
        #itemDetailPage .image-container.no-image-detail {
            height: 250px;
            background-color: #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1em;
            color: #666;
            font-weight: bold;
        }

        #itemDetailPage .text-content {
            flex-grow: 1;
        }
        
        #itemDetailPage .text-content h2 {
            font-size: 1.6em;
            color: #34495e;
            margin-top: 0;
            margin-bottom: 10px;
        }
        
        #itemDetailPage .text-content p {
            font-size: 1em;
            color: #555;
            margin-bottom: 20px;
            white-space: pre-wrap;
        }
        
        #itemDetailPage .text-content strong {
            color: #3498db;
            display: block;
            margin-top: 10px;
        }
        
        #itemDetailPage .application-form-section {
            padding: 20px;
            border: 2px solid #27ae60;
            border-radius: 10px;
            background-color: #f0fff0;
        }
        
        #itemDetailPage .application-form-section h4 {
            color: #27ae60;
            margin-top: 0;
            border-bottom: 1px dashed #2ecc71;
            padding-bottom: 10px;
        }

        /* --- ëª¨ë°”ì¼ ìµœì í™” --- */
        @media (max-width: 600px) {
            
            body { padding: 10px 5px; }
            .container { padding: 15px; }
            
            #buttonContainer {
                flex-direction: column; 
                align-items: stretch;
                gap: 10px;
            }
            
            .action-group {
                gap: 10px;
                justify-content: space-between;
                width: 100%;
            }
            
            #registerButtonContainer button, #categoryButton {
                flex-grow: 1;
                margin-left: 0;
            }

            .item-card {
                flex-direction: row; 
                align-items: center; 
            }

            .item-actions {
                margin-top: 0;
                text-align: left; 
            }
            
            .action-btn {
                padding: 6px 8px;
                font-size: 0.75em;
                display: inline-block; 
                margin: 0 4px 0 0;
            }
            
            .category-grid {
                grid-template-columns: repeat(2, 1fr); 
                gap: 15px;
            }

            .info-group {
                grid-template-columns: 1fr; 
            }
            
            .category-item {
                height: 80px;
                font-size: 1em;
            }

            /* ìƒì„¸ í˜ì´ì§€ ëª¨ë°”ì¼ ì¡°ì • */
            #itemDetailPage .item-detail-info {
                flex-direction: column;
            }
            #itemDetailPage .image-container {
                max-width: 100%;
                width: 100%; 
            }
        }
        
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ ë¬´ë£Œ ë‚˜ëˆ” ê²Œì‹œíŒ</h1>
        
        <div id="mainContent">
            
            <div class="search-container">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="ë¬¼í’ˆ ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰...">
                    <span class="search-icon">ğŸ”</span>
                </div>
            </div>
            
            <div id="buttonContainer">
                <div class="action-group">
                    <button id="categoryButton" onclick="showPage('categoryPage')">ğŸ·ï¸ ì¹´í…Œê³ ë¦¬</button>
                </div>
                <div id="registerButtonContainer" class="action-group">
                    <button onclick="showPage('registrationFormPage')">ğŸ“¦ ë¬¼í’ˆ ë“±ë¡ ìš”ì²­</button>
                </div>
            </div>
            
            <div id="currentCategoryDisplay" style="margin-bottom: 15px; font-weight: bold; display: none;">
                í˜„ì¬ ì¹´í…Œê³ ë¦¬: <span id="selectedCategoryName" style="color:#3498db;"></span>
                <button onclick="filterByCategory(null)" style="margin-left: 10px; padding: 5px 10px; font-size: 0.8em;">ì´ˆê¸°í™”</button>
            </div>
            
            <div id="item-list-container" class="list-container">
                </div>
            
        </div>
        
        <div id="categoryPage" style="display: none;">
            <h2>ğŸ·ï¸ ì¹´í…Œê³ ë¦¬ ì„ íƒ</h2>
            <p>ì›í•˜ëŠ” ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì—¬ í•´ë‹¹ ë¬¼í’ˆë§Œ í™•ì¸í•˜ì„¸ìš”.</p>
            
            <button class="cancel-btn" onclick="showPage('main')" style="width: auto; margin-bottom: 20px;">ë©”ì¸ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>

            <div class="category-grid">
                </div>
        </div>

        <div id="itemDetailPage" style="display: none;">
            </div>

        <div id="adminListPage" style="display: none;">
            <h2>ğŸš¨ ê´€ë¦¬ ëŒ€ê¸° ëª©ë¡ (ë“±ë¡ ìŠ¹ì¸ ë° ê±°ë˜ ê´€ë¦¬)</h2>
            <p>ì‹ ê·œ ë“±ë¡ ìŠ¹ì¸, ë‚˜ëˆ” ì‹ ì²­ ìŠ¹ì¸, ê±°ë˜ í™•ì • ê´€ë¦¬ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.</p>
            <p style="color:#e74c3c; font-weight:bold;">âœ… í˜„ì¬ ê´€ë¦¬ì ë¶€ì„œ: <span id="currentAdminDept">ë¡œê·¸ì•„ì›ƒ ìƒíƒœ</span></p>
            
            <button class="cancel-btn" onclick="showPage('main')" style="width: auto; margin-bottom: 20px;">ë©”ì¸ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>

            <div id="adminListContainer" class="list-container">
                </div>
        </div>

        <div id="registrationFormPage" style="display: none;">
            <h3>ë¬¼í’ˆ ë“±ë¡ ìš”ì²­</h3>
            <div class="form-content">
                
                <label for="itemName" class="form-label">ë¬¼í’ˆ ì´ë¦„</label>
                <input type="text" id="itemName" placeholder="ë¬¼í’ˆ ì´ë¦„">
                
                <label class="form-label" style="margin-top: 15px;">ë“±ë¡ì ì •ë³´ (í•„ìˆ˜)</label>
                <div class="info-group">
                    <input type="text" id="requesterName" placeholder="ì´ë¦„">
                    <select id="requesterDept">
                        </select>
                    <input type="text" id="requesterTeam" placeholder="íŒ€">
                    <input type="text" id="requesterId" placeholder="ê³ ìœ ë²ˆí˜¸">
                </div>

                <label for="itemCategory" class="form-label" style="margin-top: 15px;">ì¹´í…Œê³ ë¦¬ ì„ íƒ</label>
                <select id="itemCategory">
                    </select>

                <label for="itemImageFile" class="form-label" style="margin-top: 15px;">ë¬¼í’ˆ ì‚¬ì§„ íŒŒì¼ ì„ íƒ (ì„ íƒ)</label>
                <input type="file" id="itemImageFile" accept="image/*">
                
                <label for="itemDescription" class="form-label" style="margin-top: 15px;">ìƒì„¸ ì„¤ëª… ë° ë‚˜ëˆ” ì¡°ê±´</label>
                <textarea id="itemDescription" placeholder="ìƒì„¸ ì„¤ëª… ë° ë‚˜ëˆ” ì¡°ê±´ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."></textarea>
                
                <div class="form-actions">
                    <button onclick="addItemAsync()">ë“±ë¡ ìš”ì²­í•˜ê¸°</button>
                    <button class="cancel-btn" onclick="showPage('main')">ì·¨ì†Œ</button>
                </div>
            </div>
        </div>

    </div>
    
    <footer>
        <button id="adminListBtn" onclick="showPage('adminListPage')" style="display: none; background-color: #e74c3c; color: white; margin-right: 15px;"></button>
        <button id="adminLoginBtn" onclick="toggleAdminLogin()">ê´€ë¦¬ì ë¡œê·¸ì¸</button>
    </footer>

    <script>
        let isAdmin = false;
        let adminDept = null; // ğŸš€ ì¶”ê°€: ë¡œê·¸ì¸ëœ ê´€ë¦¬ìì˜ ë¶€ì„œ ì •ë³´ ('1ë¶€', '2ë¶€' ë“±)
        
        let currentCategoryFilter = null; // í˜„ì¬ ì„ íƒëœ ì¹´í…Œê³ ë¦¬ í•„í„°
        let currentItemId = null; // í˜„ì¬ ìƒì„¸ í˜ì´ì§€ì—ì„œ ë³´ê³  ìˆëŠ” ì•„ì´í…œ ID

        const categories = ['ìœ ì•„ìš©í’ˆ', 'ì˜ë¥˜', 'ì¡í™”', 'ì†Œí˜•ê°€ì „', 'ëŒ€í˜•ê°€ì „', 'ê°€êµ¬'];
        const departments = ['1ë¶€', '2ë¶€', '3ë¶€', '4ë¶€']; 
        
        // ğŸš€ ì¶”ê°€: ê´€ë¦¬ì ë¶€ì„œë³„ ë¹„ë°€ë²ˆí˜¸ ë§µ
        const adminPasswords = {
             '1ë¶€': 'dept1',
             '2ë¶€': 'dept2',
             '3ë¶€': 'dept3',
             '4ë¶€': 'dept4'
        };
        
        const NO_IMAGE_TEXT = 'ì´ë¯¸ì§€ ì—†ìŒ';
        const NO_IMAGE_PLACEHOLDER = 'https://via.placeholder.com/250/808080/FFFFFF?text=No+Image'; 
        const THUMBNAIL_PLACEHOLDER = 'https://via.placeholder.com/60/808080/FFFFFF?text=No+Img'; 
        
        function isValidImageUrl(url) {
            return url && url.trim() !== '' && url.indexOf('No+Image') === -1 && url.indexOf('No+Img') === -1;
        }

        // --- ì•„ì´í…œ ë°ì´í„° (ë¶€ì„œ ë°ì´í„° ë³´ê°•) ---
        const items = [
            { id: 1, name: 'ìœ ì•„ ì¹´ì‹œíŠ¸ (ISOFIX)', status: 'íŒë§¤ ì¤‘', description: 'ì‚¬ìš© ê¸°ê°„ 1ë…„ ë¯¸ë§Œ, ê¹¨ë—í•˜ê²Œ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. ì•ˆì „ê¸°ì¤€ í†µê³¼ ì œí’ˆ.', imageUrl: 'https://via.placeholder.com/150/007BFF/FFFFFF?text=CarSeat', historyStatus: 'ì‹ ì²­ ì—†ìŒ', category: 'ìœ ì•„ìš©í’ˆ', requesterInfo: { name: 'ê¹€ë‚˜ëˆ”', dept: '1ë¶€', team: 'ìš´ì˜íŒ€', id: 'A100' }, historyBuyerInfo: null, registerDate: '2025-11-10' },
            { id: 2, name: 'ì—¬ì„±ìš© ê²¨ìš¸ ì½”íŠ¸ (90)', status: 'ê±°ë˜ ì™„ë£Œ', description: 'ìš¸ 80% í˜¼ë°©, ìƒíƒœ ë§¤ìš° ì¢‹ìŠµë‹ˆë‹¤. ë“œë¼ì´í´ë¦¬ë‹ ì™„ë£Œ.', imageUrl: 'https://via.placeholder.com/150/8B4513/FFFFFF?text=Coat', historyStatus: 'ê±°ë˜ í™•ì •', category: 'ì˜ë¥˜', requesterInfo: { name: 'ì´ìŠ¤íƒ€ì¼', dept: '2ë¶€', team: 'í”„ë¡ íŠ¸', id: 'B201' }, historyBuyerInfo: { name: 'í…ŒìŠ¤íŠ¸êµ¬ë§¤ì2', dept: '2ë¶€', team: 'ë§ˆì¼€íŒ…íŒ€', id: 'B222' }, registerDate: '2025-11-11' },
            { id: 3, name: 'ìŠ¤í…Œì¸ë¦¬ìŠ¤ í…€ë¸”ëŸ¬ 500ml', status: 'ì˜ˆì•½ì¤‘', description: 'ìƒˆìƒí’ˆì´ë©° ë³´ì˜¨/ë³´ëƒ‰ ë›°ì–´ë‚©ë‹ˆë‹¤. ì‚¬ë¬´ì‹¤ì—ì„œ ìœ ìš©.', imageUrl: '', historyStatus: 'ì˜ˆì•½ ìŠ¹ì¸', category: 'ì¡í™”', requesterInfo: { name: 'ë°•ì§ì¥', dept: '3ë¶€', team: 'ë¶€ì‚°ì§€ì ', id: 'C305' }, historyBuyerInfo: { name: 'í…ŒìŠ¤íŠ¸êµ¬ë§¤ì1', dept: '1ë¶€', team: 'ê°œë°œíŒ€', id: 'A111' }, registerDate: '2025-11-12' },
            { id: 4, name: 'í•¸ë””í˜• ë¬´ì„  ì²­ì†Œê¸°', status: 'ìŠ¹ì¸ ëŒ€ê¸°', description: 'ê°„ë‹¨í•œ ì²­ì†Œìš©ìœ¼ë¡œ ì¢‹ìœ¼ë‚˜ ë°°í„°ë¦¬ ìˆ˜ëª…ì´ ì¡°ê¸ˆ ì¤„ì—ˆìŠµë‹ˆë‹¤.', imageUrl: null, historyStatus: 'ì‹ ì²­ ì—†ìŒ', category: 'ì†Œí˜•ê°€ì „', requesterInfo: { name: 'ìµœê¹”ë”', dept: '4ë¶€', team: 'ê³ ê³ í•™íŒ€', id: 'D410' }, historyBuyerInfo: null, registerDate: '2025-11-13' },
            { id: 5, name: 'ì ‘ì´ì‹ ì›ëª© í…Œì´ë¸”', status: 'ì˜ˆì•½ì¤‘', description: 'ë² ë€ë‹¤ë‚˜ ì›ë£¸ì— ì í•©í•œ ì‘ì€ í…Œì´ë¸”ì…ë‹ˆë‹¤. ë‹¤ë¦¬ ì ‘í˜ ê¸°ëŠ¥.', imageUrl: 'https://via.placeholder.com/150/A0522D/FFFFFF?text=Table', historyStatus: 'ì‹ ì²­ ì¤‘', category: 'ê°€êµ¬', requesterInfo: { name: 'í•œë¦¬ë¹™', dept: '1ë¶€', team: 'ì „ëµíŒ€', id: 'E500' }, historyBuyerInfo: { name: 'í…ŒìŠ¤íŠ¸êµ¬ë§¤ì1', dept: '1ë¶€', team: 'ê°œë°œíŒ€', id: 'A111' }, registerDate: '2025-11-13' },
            { id: 6, name: 'ì•„ê¸°ìš© ì²´ì˜¨ê³„', status: 'íŒë§¤ ì¤‘', description: 'ê·€ ì²´ì˜¨ê³„ì…ë‹ˆë‹¤. ì—¬ë¶„ í•„í„° ëª‡ ê°œ ê°™ì´ ë“œë¦½ë‹ˆë‹¤.', imageUrl: 'https://via.placeholder.com/150/FFC107/333333?text=Thermo', historyStatus: 'ì‹ ì²­ ì—†ìŒ', category: 'ìœ ì•„ìš©í’ˆ', requesterInfo: { name: 'ê°•ìœ¡ì•„', dept: '2ë¶€', team: 'íšŒê³„', id: 'F603' }, historyBuyerInfo: null, registerDate: '2025-11-14' },
            { id: 7, name: 'ë‚¨ì„± ì •ì¥ ë°”ì§€ (30ì¸ì¹˜)', status: 'ìŠ¹ì¸ ëŒ€ê¸°', description: 'ìŠ¬ë¦¼í•, ë„¤ì´ë¹„ ìƒ‰ìƒì…ë‹ˆë‹¤. ì‚¬ì´ì¦ˆê°€ ë§ì§€ ì•Šì•„ ë‚˜ëˆ”í•©ë‹ˆë‹¤.', imageUrl: '   ', historyStatus: 'ì‹ ì²­ ì—†ìŒ', category: 'ì˜ë¥˜', requesterInfo: { name: 'ê³ íŒ¨ì…˜', dept: '3ë¶€', team: 'ì±„ìš©', id: 'G777' }, historyBuyerInfo: null, registerDate: '2025-11-15' },
            { id: 8, name: 'ìº í•‘ìš© ì ‘ì´ì‹ ì˜ì 2ê°œ', status: 'íŒë§¤ ì¤‘', description: 'ì•¼ì™¸ ìº í•‘ ë° ë‚šì‹œìš©ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.', imageUrl: 'https://via.placeholder.com/150/228B22/FFFFFF?text=Chair', historyStatus: 'ì‹ ì²­ ì—†ìŒ', category: 'ê°€êµ¬', requesterInfo: { name: 'í™ìº í•‘', dept: '4ë¶€', team: 'ê°œë°œíŒ€', id: 'A110' }, historyBuyerInfo: null, registerDate: '2025-11-16' },
            { id: 9, name: 'ë¯¸ë‹ˆ ê³µê¸°ì²­ì •ê¸° (ì°¨ëŸ‰ìš©)', status: 'ì˜ˆì•½ì¤‘', description: 'USB ì „ì› ì‚¬ìš©. ì°¨ëŸ‰ì´ë‚˜ ì‘ì€ ë°©ì— ì í•©í•©ë‹ˆë‹¤.', imageUrl: 'https://via.placeholder.com/150/00FFFF/000000?text=AirPuri', historyStatus: 'ì‹ ì²­ ì¤‘', category: 'ì†Œí˜•ê°€ì „', requesterInfo: { name: 'ì´ë§‘ìŒ', dept: '1ë¶€', team: 'ì´ë¬´íŒ€', id: 'B221' }, historyBuyerInfo: { name: 'í…ŒìŠ¤íŠ¸êµ¬ë§¤ì2', dept: '2ë¶€', team: 'ë§ˆì¼€íŒ…íŒ€', id: 'B222' }, registerDate: '2025-11-17' },
            { id: 10, name: 'ë¶„ìœ  í¬íŠ¸ (ì˜¨ë„ ìœ ì§€ ê¸°ëŠ¥)', status: 'ì˜ˆì•½ì¤‘', description: 'ì‹ ìƒì•„ ë¶„ìœ  íƒ€ê¸°ì— ìµœì í™”ëœ í¬íŠ¸. ì‚¬ìš©ê° ìˆìŠµë‹ˆë‹¤.', imageUrl: 'https://via.placeholder.com/150/DC3545/FFFFFF?text=FormulaPot', historyStatus: 'ì˜ˆì•½ ìŠ¹ì¸', category: 'ìœ ì•„ìš©í’ˆ', requesterInfo: { name: 'ê¹€ë°”í‹€', dept: '2ë¶€', team: 'í•´ì™¸ì˜ì—…', id: 'C335' }, historyBuyerInfo: { name: 'í…ŒìŠ¤íŠ¸êµ¬ë§¤ì2', dept: '2ë¶€', team: 'ë§ˆì¼€íŒ…íŒ€', id: 'B222' }, registerDate: '2025-11-18' },
            { id: 11, name: 'ì—¬í–‰ìš© ë°±íŒ© (ë…¸íŠ¸ë¶ ìˆ˜ë‚©)', status: 'ê±°ë˜ ì™„ë£Œ', description: '3ë°• 4ì¼ ì—¬í–‰ìš©ìœ¼ë¡œ ì í•©í•œ ë°±íŒ©. ë…¸íŠ¸ë¶ ìˆ˜ë‚© ê³µê°„ ë³„ë„.', imageUrl: 'https://via.placeholder.com/150/A9A9A9/000000?text=Backpack', historyStatus: 'ê±°ë˜ í™•ì •', category: 'ì¡í™”', requesterInfo: { name: 'ë°•ì—¬í–‰', dept: '3ë¶€', team: 'AIë©', id: 'D440' }, historyBuyerInfo: { name: 'í…ŒìŠ¤íŠ¸êµ¬ë§¤ì1', dept: '1ë¶€', team: 'ê°œë°œíŒ€', id: 'A111' }, registerDate: '2025-11-19' },
            { id: 12, name: '27ì¸ì¹˜ LED ëª¨ë‹ˆí„°', status: 'íŒë§¤ ì¤‘', description: 'í™”ë©´ ìƒíƒœ ì–‘í˜¸í•˜ë©°, HDMI ì¼€ì´ë¸” í•¨ê»˜ ë“œë¦½ë‹ˆë‹¤. ì¬íƒê·¼ë¬´ìš©.', imageUrl: 'https://via.placeholder.com/150/800080/FFFFFF?text=Monitor', historyStatus: 'ì‹ ì²­ ì—†ìŒ', category: 'ì†Œí˜•ê°€ì „', requesterInfo: { name: 'ìµœê°œë°œ', dept: '4ë¶€', team: 'ì»¨í…ì¸ íŒ€', id: 'E550' }, historyBuyerInfo: null, registerDate: '2025-11-20' },
            { id: 13, name: 'ì–‘ë¬¸í˜• ëƒ‰ì¥ê³  (êµ¬í˜•)', status: 'íŒë§¤ ì¤‘', description: '10ë…„ ëœ êµ¬í˜• ëª¨ë¸ì´ë‚˜ ì‘ë™ì— ë¬¸ì œ ì—†ìŠµë‹ˆë‹¤. ì§ì ‘ ìš´ë°˜í•˜ì…”ì•¼ í•©ë‹ˆë‹¤.', imageUrl: 'https://via.placeholder.com/150/4682B4/FFFFFF?text=Fridge', historyStatus: 'ì‹ ì²­ ì—†ìŒ', category: 'ëŒ€í˜•ê°€ì „', requesterInfo: { name: 'í•œì‚´ë¦¼', dept: '1ë¶€', team: 'ì„¸ë¬´', id: 'F663' }, historyBuyerInfo: null, registerDate: '2025-11-21' },
            { id: 14, name: 'ì—¬ì„±ìš© ê°€ì£½ ì¥ê°‘', status: 'íŒë§¤ ì¤‘', description: 'ë¸”ë™ ìƒ‰ìƒ, ì•ˆê° ê¸°ëª¨ ì²˜ë¦¬ëœ ê²¨ìš¸ ì¥ê°‘.', imageUrl: 'https://via.placeholder.com/150/556B2F/FFFFFF?text=Glove', historyStatus: 'ì‹ ì²­ ì—†ìŒ', category: 'ì˜ë¥˜', requesterInfo: { name: 'ê°•ê²¨ìš¸', dept: '2ë¶€', team: 'êµìœ¡', id: 'G770' }, historyBuyerInfo: null, registerDate: '2025-11-22' },
            { id: 15, name: 'ì „ê¸°ë°¥ì†¥ 6ì¸ìš©', status: 'íŒë§¤ ì¤‘', description: 'ê¹¨ë—í•˜ê²Œ ì‚¬ìš©í•œ 6ì¸ìš© ë°¥ì†¥ì…ë‹ˆë‹¤. ë‚´ì†¥ ìƒíƒœ ì–‘í˜¸.', imageUrl: 'https://via.placeholder.com/150/9932CC/FFFFFF?text=RiceCooker', historyStatus: 'ì‹ ì²­ ì—†ìŒ', category: 'ì†Œí˜•ê°€ì „', requesterInfo: { name: 'ê³ ì£¼ë°©', dept: '3ë¶€', team: 'ìš´ì˜íŒ€', id: 'A101' }, historyBuyerInfo: null, registerDate: '2025-11-23' },
            { id: 16, name: '3ë‹¨ ì„œëì¥', status: 'íŒë§¤ ì¤‘', description: 'ê¸°ë³¸ì ì¸ 3ë‹¨ ì„œëì¥ì…ë‹ˆë‹¤. ì•½ê°„ì˜ ì‚¬ìš©ê° ìˆìŒ.', imageUrl: 'https://via.placeholder.com/150/CD853F/FFFFFF?text=Drawer', historyStatus: 'ì‹ ì²­ ì—†ìŒ', category: 'ê°€êµ¬', requesterInfo: { name: 'í™ìˆ˜ë‚©', dept: '4ë¶€', team: 'ë°±ì—”ë“œ', id: 'B202' }, historyBuyerInfo: null, registerDate: '2025-11-24' },
            { id: 17, name: 'ë¶„ë¦¬ìˆ˜ê±°í•¨ 3ì¢… ì„¸íŠ¸', status: 'ìŠ¹ì¸ ëŒ€ê¸°', description: 'ì¢…ì´/í”Œë¼ìŠ¤í‹±/ìº” 3ê°€ì§€ë¡œ ë‚˜ë‰œ ë¶„ë¦¬ìˆ˜ê±°í•¨.', imageUrl: 'https://via.placeholder.com/150/B0C4DE/000000?text=Recycle', historyStatus: 'ì‹ ì²­ ì—†ìŒ', category: 'ì¡í™”', requesterInfo: { name: 'ì´ì²­ì†Œ', dept: '1ë¶€', team: 'ê°•ë‚¨ì§€ì ', id: 'C306' }, historyBuyerInfo: null, registerDate: '2025-11-25' },
            { id: 18, name: 'ì „ê¸°ì¥íŒ (ì‹±ê¸€ ì‚¬ì´ì¦ˆ)', status: 'íŒë§¤ ì¤‘', description: 'ì˜¨ë„ ì¡°ì ˆ ì˜ ë©ë‹ˆë‹¤. ë³´ê´€ ì‹œ ìƒê¸´ ì ‘í˜ ìêµ­ ì•½ê°„ ìˆìŒ.', imageUrl: 'https://via.placeholder.com/150/FF69B4/FFFFFF?text=HeatingPad', historyStatus: 'ì‹ ì²­ ì—†ìŒ', category: 'ëŒ€í˜•ê°€ì „', requesterInfo: { name: 'ê¹€ì˜¨ëŒ', dept: '2ë¶€', team: 'í™”í•™íŒ€', id: 'D411' }, historyBuyerInfo: null, registerDate: '2025-11-26' },
            { id: 19, name: 'ë‚¨ì„± ìºì£¼ì–¼ ì¬í‚· (100)', status: 'ê±°ë˜ ì™„ë£Œ', description: 'ë´„/ê°€ì„ìš© ë©´ ì¬í‚·ì…ë‹ˆë‹¤. ìœ í–‰ íƒ€ì§€ ì•ŠëŠ” ë””ìì¸.', imageUrl: 'https://via.placeholder.com/150/808080/FFFFFF?text=Jacket', historyStatus: 'ê±°ë˜ í™•ì •', category: 'ì˜ë¥˜', requesterInfo: { name: 'ë°•ì§ë¬¼', dept: '3ë¶€', team: 'ë¸Œëœë“œíŒ€', id: 'E501' }, historyBuyerInfo: { name: 'í…ŒìŠ¤íŠ¸êµ¬ë§¤ì2', dept: '2ë¶€', team: 'ë§ˆì¼€íŒ…íŒ€', id: 'B222' }, registerDate: '2025-11-27' },
            { id: 20, name: 'ì•„ê¸° ë°”ìš´ì„œ', status: 'ì˜ˆì•½ì¤‘', description: 'ì§„ë™ ê¸°ëŠ¥ ì˜ ì‘ë™í•©ë‹ˆë‹¤. ì‹œíŠ¸ ì„¸íƒ ì™„ë£Œ.', imageUrl: 'https://via.placeholder.com/150/FFD700/000000?text=Bouncer', historyStatus: 'ì˜ˆì•½ ìŠ¹ì¸', category: 'ìœ ì•„ìš©í’ˆ', requesterInfo: { name: 'ìµœë†€ì´', dept: '4ë¶€', team: 'ìê¸ˆ', id: 'F604' }, historyBuyerInfo: { name: 'í…ŒìŠ¤íŠ¸êµ¬ë§¤ì1', dept: '1ë¶€', team: 'ê°œë°œíŒ€', id: 'A111' }, registerDate: '2025-11-28' }
        ];

        // ì´ˆê¸°í™” í•¨ìˆ˜
        window.onload = function() {
            showPage('main');
        };
        
        // --- í˜ì´ì§€ ì „í™˜ ê´€ë¦¬ í•¨ìˆ˜ ---
        function showPage(pageId, itemId = null) {
            const pages = ['mainContent', 'registrationFormPage', 'adminListPage', 'categoryPage', 'itemDetailPage'];
            pages.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.style.display = 'none';
                }
            });

            if (pageId === 'main') {
                document.getElementById('mainContent').style.display = 'block';
                searchItems(); 
            } else if (pageId === 'registrationFormPage') {
                document.getElementById('registrationFormPage').style.display = 'block';
                renderCategorySelect();
                renderDeptSelect('requesterDept');
            } else if (pageId === 'adminListPage') {
                document.getElementById('adminListPage').style.display = 'block';
                // ğŸš€ ì¶”ê°€: ê´€ë¦¬ì ë¶€ì„œ í‘œì‹œ ì—…ë°ì´íŠ¸
                document.getElementById('currentAdminDept').textContent = isAdmin ? adminDept : 'ë¡œê·¸ì•„ì›ƒ ìƒíƒœ';
                renderAdminList();
            } else if (pageId === 'categoryPage') {
                document.getElementById('categoryPage').style.display = 'block';
                renderCategoryGrid();
            } else if (pageId === 'itemDetailPage') {
                document.getElementById('itemDetailPage').style.display = 'block';
                if (itemId !== null) {
                    renderItemDetailPage(itemId);
                }
            }
            
            // ê´€ë¦¬ì ë²„íŠ¼ ì—…ë°ì´íŠ¸ëŠ” í•­ìƒ í˜¸ì¶œ
            updateAdminButtonStatus(); 
        }

        function toggleDetails(itemId, event) {
            const detailDiv = document.getElementById(`detail-${itemId}`);
            
            // ë²„íŠ¼ í´ë¦­ ì‹œ ìƒì„¸ ì •ë³´ í† ê¸€ì„ ë§‰ìŒ
            const isTargetButton = event.target.closest('.item-actions') !== null || event.target.closest('.admin-action-btn') !== null;
            if (isTargetButton) return;
            
            if (detailDiv.style.display === 'block') { 
                detailDiv.style.display = 'none';
            } else {
                document.querySelectorAll('.detail-row').forEach(div => {
                    if (div.id !== `detail-${itemId}`) {
                        div.style.display = 'none';
                    }
                });
                detailDiv.style.display = 'block'; 
            }
        }
        
        function getTodayDate() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function getStatusClass(status) {
            if (status === 'ìŠ¹ì¸ ëŒ€ê¸°') return 'status-waiting';
            if (status === 'íŒë§¤ ì¤‘') return 'status-selling'; 
            if (status === 'ì˜ˆì•½ì¤‘') return 'status-reserved'; 
            if (status === 'ê±°ë˜ ì™„ë£Œ') return 'status-completed'; 
            if (status === 'ì·¨ì†Œë¨') return 'status-cancelled';
            return '';
        }
        
        function getDisplayStatusText(internalStatus, item) {
            if (internalStatus === 'ìŠ¹ì¸ ëŒ€ê¸°') return 'ìŠ¹ì¸ ëŒ€ê¸°';
            if (internalStatus === 'íŒë§¤ ì¤‘') return 'ì‹ ì²­ ê°€ëŠ¥'; 
            if (internalStatus === 'ê±°ë˜ ì™„ë£Œ') {
                return 'ë‚˜ëˆ” ì™„ë£Œ'; 
            }
            
            if (internalStatus === 'ì˜ˆì•½ì¤‘') {
                if (item.historyStatus === 'ì˜ˆì•½ ìŠ¹ì¸') {
                     return 'ì˜ˆì•½ í™•ì •'; 
                } else if (item.historyStatus === 'ì‹ ì²­ ì¤‘') {
                    return 'ì˜ˆì•½ ëŒ€ê¸°'; 
                } else {
                    return 'ì˜ˆì•½ì¤‘'; 
                }
            }
            
            return internalStatus;
        }
        
        // --- ì¹´í…Œê³ ë¦¬ í˜ì´ì§€ ê´€ë ¨ í•¨ìˆ˜ ---
        function renderCategoryGrid() {
            const gridContainer = document.querySelector('#categoryPage .category-grid');
            gridContainer.innerHTML = '';
            
            categories.forEach(category => {
                const item = document.createElement('div');
                item.classList.add('category-item');
                item.textContent = category;
                item.onclick = () => {
                    filterByCategory(category);
                    showPage('main'); 
                };
                gridContainer.appendChild(item);
            });
            
            const allItem = document.createElement('div');
            allItem.classList.add('category-item');
            allItem.textContent = 'ì „ì²´ ë³´ê¸°';
            allItem.onclick = () => {
                filterByCategory(null);
                showPage('main'); 
            };
            gridContainer.appendChild(allItem);
        }
        
        function filterByCategory(category) {
            currentCategoryFilter = category;
            const display = document.getElementById('currentCategoryDisplay');
            const nameSpan = document.getElementById('selectedCategoryName');
            
            if (category) {
                display.style.display = 'block';
                nameSpan.textContent = category;
            } else {
                display.style.display = 'none';
                nameSpan.textContent = '';
            }
            
            searchItems(); 
        }
        
        function renderCategorySelect() {
            const select = document.getElementById('itemCategory');
            select.innerHTML = '<option value="">--- ì¹´í…Œê³ ë¦¬ ì„ íƒ ---</option>';
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                select.appendChild(option);
            });
        }
        
        // --- ë¶€ì„œ ì„ íƒ ë“œë¡­ë‹¤ìš´ ë Œë”ë§ í•¨ìˆ˜ ---
        function renderDeptSelect(elementId, defaultValue = '') {
            const select = document.getElementById(elementId);
            if (!select) return;

            select.innerHTML = `<option value="">--- ë¶€ì„œ ì„ íƒ (í•„ìˆ˜) ---</option>`;
            departments.forEach(dept => {
                const option = document.createElement('option');
                option.value = dept;
                option.textContent = dept;
                if (dept === defaultValue) {
                    option.selected = true;
                }
                select.appendChild(option);
            });
        }
        
        // --- í•µì‹¬: ë©”ì¸ ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§ í•¨ìˆ˜ ---
        function renderItems(displayItems) {
            const listContainer = document.getElementById('item-list-container');
            listContainer.innerHTML = ''; 
            
            let filteredByCat = displayItems;
            if (currentCategoryFilter) {
                 filteredByCat = displayItems.filter(item => item.category === currentCategoryFilter);
            }
            
            const statusOrder = { 'íŒë§¤ ì¤‘': 1, 'ì˜ˆì•½ì¤‘': 2, 'ê±°ë˜ ì™„ë£Œ': 3 };
            
            filteredByCat.sort((a, b) => {
                const orderA = statusOrder[a.status] || 99;
                const orderB = statusOrder[b.status] || 99;
                return orderA - orderB;
            });
            
            const finalDisplayItems = filteredByCat;

            if (finalDisplayItems.length === 0) {
                 listContainer.innerHTML = '<p style="text-align: center; color: #777; padding: 20px; margin: 0;">í•´ë‹¹ ì¡°ê±´ì— ë§ëŠ” ë¬¼í’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                 return;
            }

            finalDisplayItems.forEach(item => {
                
                const isNoImage = !isValidImageUrl(item.imageUrl);
                const displayImageUrl = isNoImage ? THUMBNAIL_PLACEHOLDER : item.imageUrl;
                
                let thumbnailHtml = '';
                if (isNoImage) {
                    thumbnailHtml = `<div class="item-thumbnail-wrapper">${NO_IMAGE_TEXT}</div>`;
                } else {
                    thumbnailHtml = `<div class="item-thumbnail-wrapper"><img src="${displayImageUrl}" alt="${item.name} ì´ë¯¸ì§€" class="item-thumbnail"></div>`;
                }

                let statusText = getDisplayStatusText(item.status, item); 
                let statusClass = getStatusClass(item.status);
                
                let actionButton = '';
                if (isAdmin) {
                    actionButton = `
                        <button class="admin-action-btn edit-btn" onclick="editItem(${item.id})">ìˆ˜ì •</button>
                        <button class="admin-action-btn delete-btn item-delete-btn" data-item-id="${item.id}">ì‚­ì œ</button>
                    `;
                } else if (item.status === 'íŒë§¤ ì¤‘') { 
                    // ë²„íŠ¼ í´ë¦­ ì‹œ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™
                    actionButton = `<button class="action-btn trade-apply-btn" onclick="showPage('itemDetailPage', ${item.id})">ë‚˜ëˆ” ì‹ ì²­</button>`;
                } else if (item.status === 'ì˜ˆì•½ì¤‘') {
                    actionButton = `<span class="${statusClass}">${statusText}</span>`; 
                }

                
                // ë“±ë¡ì ì •ë³´ í‘œì‹œ ì—¬ë¶€ ê²°ì • (ê´€ë¦¬ì ì „ìš©)
                let requesterInfoPart = '';
                if (isAdmin) {
                    requesterInfoPart = ` | ë“±ë¡ì: ${item.requesterInfo.name} (${item.requesterInfo.dept})`;
                }
                
                const card = document.createElement('div');
                card.classList.add('item-card');
                card.setAttribute('data-id', item.id);
                
                card.innerHTML = `
                    ${thumbnailHtml}
                    <div class="item-content">
                        <div class="item-header">
                            <span class="item-name" title="${item.name}">${item.name}</span>
                            <span class="item-status ${statusClass}">${statusText}</span>
                        </div>
                        <div class="item-info">
                            ì¹´í…Œê³ ë¦¬: ${item.category || 'ë¯¸ë¶„ë¥˜'} | ë“±ë¡ì¼: ${item.registerDate || '-'}
                            ${requesterInfoPart}
                        </div>
                        <div class="item-actions">
                            ${actionButton}
                        </div>
                    </div>
                `;
                
                card.onclick = (event) => toggleDetails(item.id, event);
                listContainer.appendChild(card);
                
                if (isAdmin) {
                    const deleteButton = card.querySelector(`.item-delete-btn[data-item-id="${item.id}"]`);
                    if (deleteButton) {
                        deleteButton.addEventListener('click', (event) => {
                            event.stopPropagation();
                            deleteItem(item.id);
                        });
                    }
                }

                const detailDiv = document.createElement('div');
                detailDiv.classList.add('detail-row');
                detailDiv.id = `detail-${item.id}`;
                
                const formattedDescription = (item.description || 'ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤.').replace(/\n/g, '<br>');
                const isDetailNoImage = !isValidImageUrl(item.imageUrl);
                const detailImageUrl = isDetailNoImage ? NO_IMAGE_PLACEHOLDER : item.imageUrl;
                
                let detailImageHtml = '';
                if (isDetailNoImage) {
                    detailImageHtml = `<div class="detail-image-box no-image">${NO_IMAGE_TEXT}</div>`;
                } else {
                    detailImageHtml = `<div class="detail-image-box"><img src="${detailImageUrl}" alt="${item.name} ìƒì„¸ ì´ë¯¸ì§€" class="detail-image"></div>`;
                }

                // ìƒì„¸ ë³´ê¸° íŒì—…ì—ì„œëŠ” ë“±ë¡ì ì „ì²´ ì •ë³´ë¥¼ ê´€ë¦¬ìë§Œ ë³¼ ìˆ˜ ìˆê²Œ ìœ ì§€í•©ë‹ˆë‹¤.
                let requesterInfoHtml = '';
                if (isAdmin) {
                    requesterInfoHtml = `
                        <div class="detail-text" style="margin-top: 15px;">
                            <strong>ë“±ë¡ì ì •ë³´ (ê´€ë¦¬ì ì „ìš©):</strong><br>
                            ì´ë¦„: ${item.requesterInfo.name} | ë¶€ì„œ: ${item.requesterInfo.dept} | íŒ€: ${item.requesterInfo.team} | ê³ ìœ ë²ˆí˜¸: ${item.requesterInfo.id}
                        </div>
                    `;
                }
                
                let buyerInfoHtml = '';
                if (isAdmin && item.historyBuyerInfo) {
                    buyerInfoHtml = `
                        <div class="detail-text" style="margin-top: 15px; border-top: 1px dashed #ccc; padding-top: 10px;">
                            <strong>ì‹ ì²­ì ì •ë³´ (ê´€ë¦¬ì ì „ìš©):</strong><br>
                            ì´ë¦„: ${item.historyBuyerInfo.name} | ë¶€ì„œ: ${item.historyBuyerInfo.dept} | íŒ€: ${item.historyBuyerInfo.team} | ê³ ìœ ë²ˆí˜¸: ${item.historyBuyerInfo.id}
                        </div>
                    `;
                }


                detailDiv.innerHTML = `
                    <div class="detail-content">
                        ${detailImageHtml}
                        <div class="detail-text" style="margin-bottom: 15px;">
                            <strong>ìƒì„¸ ì„¤ëª…:</strong><br>
                            ${formattedDescription}
                        </div>
                        ${requesterInfoHtml}
                        ${buyerInfoHtml}
                    </div>
                `;
                listContainer.appendChild(detailDiv);
            });
            
            updateAdminButtonStatus();
        }
        
        // --- ë¬¼í’ˆ ìƒì„¸ ë° ì‹ ì²­ í˜ì´ì§€ ë Œë”ë§ í•¨ìˆ˜ (ìˆ˜ì • ë°˜ì˜) ---
        function renderItemDetailPage(itemId) {
            const item = items.find(i => i.id === itemId);
            const detailPage = document.getElementById('itemDetailPage');
            currentItemId = itemId;

            if (!item || item.status !== 'íŒë§¤ ì¤‘') {
                detailPage.innerHTML = `
                    <h3>ğŸš« ë‚˜ëˆ” ì‹ ì²­ ë¶ˆê°€</h3>
                    <p>ì´ ë¬¼í’ˆì€ í˜„ì¬ ì‹ ì²­ ê°€ëŠ¥í•œ ìƒíƒœê°€ ì•„ë‹™ë‹ˆë‹¤.</p>
                    <button class="cancel-btn" onclick="showPage('main')">ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
                `;
                return;
            }

            const isNoImage = !isValidImageUrl(item.imageUrl);
            const displayImageUrl = isNoImage ? NO_IMAGE_PLACEHOLDER : item.imageUrl;
            
            let imageHtml = '';
            if (isNoImage) {
                imageHtml = `<div class="image-container no-image-detail">${NO_IMAGE_TEXT}</div>`;
            } else {
                imageHtml = `<div class="image-container"><img src="${displayImageUrl}" alt="${item.name} ì´ë¯¸ì§€"></div>`;
            }
            
            // ì‹ ì²­ í¼ì— ì‚¬ìš©ë  ë¶€ì„œ ë“œë¡­ë‹¤ìš´ì„ ë¯¸ë¦¬ ë Œë”ë§í•©ë‹ˆë‹¤.
            renderDeptSelect('applyDept'); 

            detailPage.innerHTML = `
                <h3>â­ ë‚˜ëˆ” ì‹ ì²­: ${item.name}</h3>
                
                <div class="item-detail-info">
                    ${imageHtml}
                    <div class="text-content">
                        <h2>${item.name}</h2>
                        <p>${item.description.replace(/\n/g, '<br>')}</p>
                        
                        <strong>ì¹´í…Œê³ ë¦¬: ${item.category || 'ë¯¸ë¶„ë¥˜'}</strong>
                        <strong>ë“±ë¡ì¼: ${item.registerDate || '-'}</strong>
                    </div>
                </div>

                <div class="application-form-section">
                    <h4>ğŸ“ ì‹ ì²­ì ì •ë³´ ì…ë ¥</h4>
                    <p>ë‚˜ëˆ”ì„ ì‹ ì²­í•˜ê¸° ìœ„í•´ ë³¸ì¸ì˜ ì •ë³´ë¥¼ ì •í™•í•˜ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”. ì´ ì •ë³´ëŠ” ë¬¼í’ˆ ë“±ë¡ìì˜ ë¶€ì„œ ê´€ë¦¬ìì—ê²Œ ì „ë‹¬ë˜ì–´ ë‚˜ëˆ” í™•ì • ì‹œ ì—°ë½ì— ì‚¬ìš©ë©ë‹ˆë‹¤.</p>
                    
                    <div class="info-group">
                        <input type="text" id="applyName" placeholder="ì´ë¦„ (í•„ìˆ˜)">
                        <select id="applyDept">
                            </select>
                        <input type="text" id="applyTeam" placeholder="íŒ€ (í•„ìˆ˜)">
                        <input type="text" id="applyId" placeholder="ê³ ìœ ë²ˆí˜¸ (í•„ìˆ˜)">
                    </div>

                    <div class="form-actions">
                        <button class="trade-apply-btn" onclick="submitTradeApplication()">ë‚˜ëˆ” ì‹ ì²­</button>
                        <button class="cancel-btn" onclick="showPage('main')">ë’¤ë¡œê°€ê¸°</button>
                    </div>
                </div>
            `;
            // renderDeptSelectë¥¼ ë‹¤ì‹œ í˜¸ì¶œí•˜ì—¬ applyDept ì—˜ë¦¬ë¨¼íŠ¸ê°€ ìƒì„±ëœ í›„ ì±„ì›Œì§€ë„ë¡ í•¨
            renderDeptSelect('applyDept');
        }

        // --- ì‹ ì²­ í¼ ì œì¶œ í•¨ìˆ˜ (ìˆ˜ì •) ---
        function submitTradeApplication() {
            const item = items.find(i => i.id === currentItemId);
            if (!item || item.status !== 'íŒë§¤ ì¤‘') {
                alert('ì‹ ì²­í•  ìˆ˜ ì—†ëŠ” ë¬¼í’ˆì…ë‹ˆë‹¤.');
                showPage('main');
                return;
            }

            const applyInfo = {
                name: document.getElementById('applyName').value.trim(),
                dept: document.getElementById('applyDept').value,
                team: document.getElementById('applyTeam').value.trim(),
                id: document.getElementById('applyId').value.trim()
            };

            if (!applyInfo.name || !applyInfo.dept || !applyInfo.team || !applyInfo.id) {
                alert('ì´ë¦„, ë¶€ì„œ, íŒ€, ê³ ìœ ë²ˆí˜¸ ë„¤ ê°€ì§€ ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // ê¸°ì¡´ ì‹ ì²­ì ì •ë³´ì™€ ì¤‘ë³µ í™•ì¸ (ê°„ë‹¨í•œ ì¤‘ë³µ ë°©ì§€: ë™ì¼ ê³ ìœ ë²ˆí˜¸ë¡œ ì˜ˆì•½ ì¤‘ì¸ ë¬¼í’ˆì´ ìˆëŠ”ì§€ í™•ì¸)
            const existingBuyer = items.find(i => 
                i.status === 'ì˜ˆì•½ì¤‘' && 
                i.historyBuyerInfo && 
                i.historyBuyerInfo.id === applyInfo.id
            );
            
            if (existingBuyer) {
                 alert(`ì´ë¯¸ ë‹¤ë¥¸ ë¬¼í’ˆì— ì‹ ì²­(ì˜ˆì•½) ì¤‘ì´ë¯€ë¡œ ì‹ ì²­í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
                 return;
            }

            item.status = 'ì˜ˆì•½ì¤‘'; 
            item.historyStatus = 'ì‹ ì²­ ì¤‘'; 
            item.historyBuyerInfo = applyInfo; 
            
            alert(`ë¬¼í’ˆ [${item.name}]ì— ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë¬¼í’ˆ ë“±ë¡ì ë¶€ì„œ(${item.requesterInfo.dept}) ê´€ë¦¬ìì˜ 1ë‹¨ê³„ ìŠ¹ì¸ì„ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.`);
            showPage('main');
        }


        // ğŸš€ ì¶”ê°€: ê´€ë¦¬ì ê¶Œí•œ í™•ì¸ í•¨ìˆ˜
        function checkAdminAuth(item, actionType) {
            if (!isAdmin) return false;
            
            let targetDept = null;
            
            if (actionType === 'register_approve' || actionType === 'delete' || actionType === 'edit') {
                // ë“±ë¡ ìŠ¹ì¸ ë° ì‚­ì œ/ìˆ˜ì •ì€ ë“±ë¡ìì˜ ë¶€ì„œ ê´€ë¦¬ì ê¶Œí•œ
                targetDept = item.requesterInfo.dept;
            } else if (actionType === 'trade_action') {
                 // ì˜ˆì•½ ì‹ ì²­ ìŠ¹ì¸/ê±°ì ˆ/ì™„ë£ŒëŠ” ë“±ë¡ì ë¶€ì„œ ê´€ë¦¬ì ê¶Œí•œ (ì‹ ì²­ìì™€ì˜ ê±°ë˜ë¥¼ ë“±ë¡ì ë¶€ì„œ ê´€ë¦¬ìê°€ ê´€ë¦¬)
                targetDept = item.requesterInfo.dept;
            } 
            
            // ì‚­ì œì˜ ê²½ìš°, ë“±ë¡ìê°€ ì‹ ì²­ìê°€ ì•„ë‹Œ ê²½ìš° ë“±ë¡ì ë¶€ì„œ ê´€ë¦¬ìê°€ ì‚­ì œ ê¶Œí•œì„ ê°€ì§.
            // ì—¬ê¸°ì„œëŠ” ëª¨ë“  ê´€ë¦¬ìê°€ ì‚­ì œ ë° ìˆ˜ì •ì„ í•  ìˆ˜ ìˆê²Œ í•˜ê±°ë‚˜, ë“±ë¡ ìŠ¹ì¸/ê±°ë˜ ê´€ë¦¬ì²˜ëŸ¼ ë¶€ì„œ ë¶„ë‹´ì„ ë”°ë¥´ë„ë¡ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            // ìš”êµ¬ì‚¬í•­ì— ë”°ë¼ ë“±ë¡ì ë¶€ì„œ ê´€ë¦¬ìë§Œ ì‚­ì œ/ìˆ˜ì • ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.
            
            return adminDept === targetDept;
        }

        // --- ê´€ë¦¬ì ëª©ë¡ ê´€ë ¨ í•¨ìˆ˜ (ë¶€ì„œ ê¶Œí•œ ì²´í¬ ì ìš©) ---
        function renderAdminList() {
            if (!isAdmin) return;

            const listContainer = document.getElementById('adminListContainer');
            listContainer.innerHTML = '';
            
            // 'ìŠ¹ì¸ ëŒ€ê¸°' ë˜ëŠ” 'ì˜ˆì•½ì¤‘'ì¸ í•­ëª©ë§Œ í•„í„°ë§
            const adminItems = items.filter(item => item.status === 'ìŠ¹ì¸ ëŒ€ê¸°' || item.status === 'ì˜ˆì•½ì¤‘');
            
            if (adminItems.length === 0) {
                 listContainer.innerHTML = '<p style="text-align: center; color: #555; padding: 20px; margin: 0;">í˜„ì¬ ê´€ë¦¬ ëŒ€ê¸° ì¤‘ì¸ ë¬¼í’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                 return;
            }

            adminItems.forEach(item => {
                let actions = '';
                let displayStatus = '';
                let buyerInfoDisplay = 'ì‹ ì²­ì ì—†ìŒ';

                if (item.historyBuyerInfo) {
                    const info = item.historyBuyerInfo;
                    buyerInfoDisplay = `ì‹ ì²­ì: ${info.name} (${info.dept} ${info.team} / ${info.id})`;
                }
                
                // ğŸš€ ê¶Œí•œ í™•ì¸
                const canApproveRegister = checkAdminAuth(item, 'register_approve'); // ë“±ë¡ ìŠ¹ì¸ ê¶Œí•œ (ë“±ë¡ì ë¶€ì„œ)
                const canManageTrade = checkAdminAuth(item, 'trade_action'); // ê±°ë˜ ê´€ë¦¬ ê¶Œí•œ (ë“±ë¡ì ë¶€ì„œ)

                if (item.status === 'ìŠ¹ì¸ ëŒ€ê¸°') {
                    displayStatus = 'ë“±ë¡ ìŠ¹ì¸ ëŒ€ê¸°';
                    
                    if(canApproveRegister) {
                        actions = `
                            <button class="admin-action-btn approve-btn" onclick="approveItem(${item.id})">âœ… ë“±ë¡ ìŠ¹ì¸</button>
                            <button class="admin-action-btn delete-btn item-delete-btn" data-item-id="${item.id}">âŒ ì‚­ì œ</button>
                        `;
                    } else {
                        actions = `<button class="admin-action-btn approve-btn disabled-btn">âŒ ê¶Œí•œ ì—†ìŒ</button>`;
                        displayStatus += ` <span class="unauthorized">(íƒ€ ë¶€ì„œ: ${item.requesterInfo.dept})</span>`;
                    }
                } else if (item.status === 'ì˜ˆì•½ì¤‘') {
                    
                    if (item.historyStatus === 'ì‹ ì²­ ì¤‘') {
                        displayStatus = 'ì˜ˆì•½ ëŒ€ê¸° (1ë‹¨ê³„)'; 
                        if(canManageTrade) {
                             actions = `
                                <button class="admin-action-btn approve-trade-btn" onclick="approveTrade(${item.id})">âœ… ì‹ ì²­ ìŠ¹ì¸</button> 
                                <button class="admin-action-btn cancel-trade-btn" onclick="cancelTradeByAdmin(${item.id})">âŒ ì‹ ì²­ ê±°ì ˆ</button>
                            `;
                        } else {
                            actions = `<button class="admin-action-btn approve-trade-btn disabled-btn">âŒ ê¶Œí•œ ì—†ìŒ</button>`;
                            displayStatus += ` <span class="unauthorized">(íƒ€ ë¶€ì„œ: ${item.requesterInfo.dept})</span>`;
                        }

                    } else if (item.historyStatus === 'ì˜ˆì•½ ìŠ¹ì¸') {
                        displayStatus = 'ì˜ˆì•½ í™•ì • (2ë‹¨ê³„)'; 
                        if(canManageTrade) {
                            actions = `
                                <button class="admin-action-btn confirm-trade-btn" onclick="confirmTrade(${item.id})">ğŸ“¦ ë‚˜ëˆ” ì™„ë£Œ</button> 
                                <button class="admin-action-btn cancel-trade-btn" onclick="cancelTradeByAdmin(${item.id})">ğŸš« ì˜ˆì•½ ì·¨ì†Œ</button>
                            `;
                        } else {
                            actions = `<button class="admin-action-btn confirm-trade-btn disabled-btn">âŒ ê¶Œí•œ ì—†ìŒ</button>`;
                            displayStatus += ` <span class="unauthorized">(íƒ€ ë¶€ì„œ: ${item.requesterInfo.dept})</span>`;
                        }
                    } else {
                         displayStatus = 'ì˜ˆì•½ì¤‘ (ìƒíƒœ ì˜¤ë¥˜)';
                    }
                }
                
                
                const isNoImage = !isValidImageUrl(item.imageUrl);
                const displayImageUrl = isNoImage ? THUMBNAIL_PLACEHOLDER : item.imageUrl;

                let thumbnailHtml = '';
                if (isNoImage) {
                    thumbnailHtml = `<div class="item-thumbnail-wrapper">${NO_IMAGE_TEXT}</div>`;
                } else {
                    thumbnailHtml = `<div class="item-thumbnail-wrapper"><img src="${displayImageUrl}" alt="${item.name} ì´ë¯¸ì§€" class="item-thumbnail"></div>`;
                }
                
                const card = document.createElement('div');
                card.classList.add('item-card', 'admin-card'); 
                card.style.cursor = 'default'; 

                card.innerHTML = `
                    ${thumbnailHtml}
                    <div class="item-content">
                        <div class="item-header">
                            <span class="item-name" title="${item.name}">${item.name}</span>
                            <span class="item-status ${getStatusClass(item.status)}">${displayStatus}</span>
                        </div>
                        <div class="admin-info">
                            ì¹´í…Œê³ ë¦¬: ${item.category || 'ë¯¸ë¶„ë¥˜'} | ë“±ë¡ì¼: ${item.registerDate || '-'}
                        </div>
                        <div class="admin-info">
                            <strong>ë“±ë¡ì ë¶€ì„œ: ${item.requesterInfo.dept}</strong> | ë“±ë¡ì: ${item.requesterInfo.name} (${item.requesterInfo.id})
                        </div>
                        <div class="admin-info">${buyerInfoDisplay}</div>
                        <div class="item-actions" style="margin-top: 10px;">
                            ${actions}
                        </div>
                    </div>
                `;
                
                listContainer.appendChild(card);
                
                // ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆëŠ” ê¶Œí•œ í™•ì¸ í›„ì—ë„ ë‹¬ì•„ì•¼ í•¨ (ê¶Œí•œì´ ì—†ìœ¼ë©´ ë²„íŠ¼ì´ ì•ˆ ëœ¸)
                if (item.status === 'ìŠ¹ì¸ ëŒ€ê¸°' && canApproveRegister) {
                    const deleteButton = card.querySelector(`.admin-action-btn.delete-btn[data-item-id="${item.id}"]`);
                    if (deleteButton) {
                        deleteButton.addEventListener('click', (event) => {
                            event.stopPropagation();
                            deleteItem(item.id);
                        });
                    }
                }
            });
        }
        
        function updateAdminButtonStatus() {
            const adminListBtn = document.getElementById('adminListBtn');
            const adminPageVisible = document.getElementById('adminListPage').style.display !== 'none';
            const registrationPageVisible = document.getElementById('registrationFormPage').style.display !== 'none';

            if (isAdmin && !adminPageVisible && !registrationPageVisible) {
                // ê´€ë¦¬ì ëª©ë¡ì— ìˆëŠ” í•­ëª©ì˜ ê°œìˆ˜ë¥¼ ë‹¤ì‹œ ê³„ì‚°í•˜ì—¬ í‘œì‹œ
                const adminCount = items.filter(item => item.status === 'ìŠ¹ì¸ ëŒ€ê¸°' || item.status === 'ì˜ˆì•½ì¤‘').length;
                adminListBtn.style.display = 'inline-block';
                adminListBtn.textContent = `ğŸš¨ ê´€ë¦¬ ëª©ë¡ (${adminCount}ê±´) [${adminDept}]`; 
            } else {
                adminListBtn.style.display = 'none';
            }
        }
        
        // --- ê¸°íƒ€ ê¸°ëŠ¥ (íŒŒì¼, ë“±ë¡, ê²€ìƒ‰ ë“±) ---

        function convertFileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                const maxSizeInBytes = 2 * 1024 * 1024; // 2MB
                if (file.size > maxSizeInBytes) {
                     reject(new Error("File size exceeds 2MB limit."));
                     return;
                }
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
                reader.readAsDataURL(file);
            });
        }

        async function addItemAsync() {
            const name = document.getElementById('itemName').value.trim();
            const rName = document.getElementById('requesterName').value.trim();
            const rDept = document.getElementById('requesterDept').value; 
            const rTeam = document.getElementById('requesterTeam').value.trim();
            const rId = document.getElementById('requesterId').value.trim();
            const category = document.getElementById('itemCategory').value; 
            const description = document.getElementById('itemDescription').value.trim(); 
            const file = document.getElementById('itemImageFile').files[0];

            if (!name || !description || !category || !rName || !rDept || !rTeam || !rId) {
                alert('ë¬¼í’ˆ ì´ë¦„, ë“±ë¡ì ì •ë³´(ì´ë¦„, ë¶€ì„œ, íŒ€, ê³ ìœ ë²ˆí˜¸), ì¹´í…Œê³ ë¦¬, ìƒì„¸ ì„¤ëª…ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            let imageUrl = '';

            if (file) {
                try {
                    imageUrl = await convertFileToBase64(file);
                } catch (error) {
                    console.error('íŒŒì¼ ë³€í™˜ ì˜¤ë¥˜:', error);
                    alert('ì´ë¯¸ì§€ íŒŒì¼ ë³€í™˜ì— ì‹¤íŒ¨í–ˆê±°ë‚˜ íŒŒì¼ í¬ê¸°ê°€ ë„ˆë¬´ í½ë‹ˆë‹¤ (ìµœëŒ€ 2MB).');
                    return;
                }
            } else {
                 imageUrl = '';
            }

            const newId = items.length > 0 ? Math.max(...items.map(i => i.id)) + 1 : 1;

            items.push({ 
                id: newId, 
                name: name, 
                status: 'ìŠ¹ì¸ ëŒ€ê¸°', 
                description: description,
                imageUrl: imageUrl,
                registerDate: getTodayDate(),
                category: category, 
                historyStatus: 'ì‹ ì²­ ì—†ìŒ',
                requesterInfo: { name: rName, dept: rDept, team: rTeam, id: rId },
                historyBuyerInfo: null 
            });
            
            alert(`ë¬¼í’ˆ [${name}]ì´(ê°€) ë“±ë¡ ìš”ì²­ë˜ì—ˆìŠµë‹ˆë‹¤. ë“±ë¡ì ë¶€ì„œ(${rDept}) ê´€ë¦¬ìì˜ ìŠ¹ì¸ì„ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.`);

            showPage('main');
        }

        function searchItems() {
            const searchTerm = document.getElementById('searchInput').value.trim().toLowerCase();
            
            let searchTargetItems = items.filter(item => item.status !== 'ìŠ¹ì¸ ëŒ€ê¸°');
            
            const filteredItems = searchTargetItems.filter(item => 
                item.name.toLowerCase().includes(searchTerm) || 
                item.description.toLowerCase().includes(searchTerm)
            );

            renderItems(filteredItems);
        }

        document.getElementById('searchInput').addEventListener('input', searchItems);

        
        // --- ê´€ë¦¬ì ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ (ìˆ˜ì •) ---
        function toggleAdminLogin() {
            if (isAdmin) {
                logoutAdmin();
            } else {
                loginAdmin();
            }
        }
        function loginAdmin() {
            const deptCode = prompt(`ê´€ë¦¬ì ë¶€ì„œ ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”. (${departments.join(', ')} ì¤‘ í•˜ë‚˜)`);
            if (deptCode === null) return;
            const password = prompt(`[${deptCode}] ê´€ë¦¬ìì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”. (ë¶€ì„œë³„ ë¹„ë°€ë²ˆí˜¸ ì˜ˆ: 1ë¶€: dept1, 2ë¶€: dept2)`);
            
            if (password === null) return;

            const expectedPassword = adminPasswords[deptCode];
            
            if (expectedPassword && password === expectedPassword) {
                isAdmin = true;
                adminDept = deptCode; // ğŸš€ ë¡œê·¸ì¸ëœ ë¶€ì„œ ì €ì¥
                document.getElementById('adminLoginBtn').innerText = `${adminDept} ê´€ë¦¬ì ë¡œê·¸ì•„ì›ƒ`;
                alert(`${adminDept} ê´€ë¦¬ì ë¡œê·¸ì¸ ì„±ê³µ.`);
                showPage('main'); 
            } else {
                alert('ë¶€ì„œ ì½”ë“œ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
            }
        }
        function logoutAdmin() {
            isAdmin = false;
            adminDept = null; // ğŸš€ ë¶€ì„œ ì •ë³´ ì´ˆê¸°í™”
            document.getElementById('adminLoginBtn').innerText = 'ê´€ë¦¬ì ë¡œê·¸ì¸';
            document.getElementById('adminListBtn').style.display = 'none'; 
            showPage('main'); 
        }
        
        // --- ê´€ë¦¬ì ì•¡ì…˜ (ê¶Œí•œ í™•ì¸ ë¡œì§ ì¶”ê°€) ---
        function approveTrade(itemId) {
            const item = items.find(i => i.id === itemId);
            if (!checkAdminAuth(item, 'trade_action')) {
                alert(`ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ì´ ê±°ë˜ëŠ” ${item.requesterInfo.dept} ê´€ë¦¬ìë§Œ ìŠ¹ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
                return;
            }
            // ìƒíƒœ í™•ì¸: ì‹ ì²­ ì¤‘ ìƒíƒœì¼ ë•Œë§Œ ìŠ¹ì¸ ê°€ëŠ¥
            if (item && item.status === 'ì˜ˆì•½ì¤‘' && item.historyStatus === 'ì‹ ì²­ ì¤‘') { 
                item.historyStatus = 'ì˜ˆì•½ ìŠ¹ì¸'; 
                alert(`${item.name}ì˜ ë‚˜ëˆ” ì‹ ì²­ì´ 1ë‹¨ê³„ ìŠ¹ì¸ë˜ì–´ 'ì˜ˆì•½ í™•ì •' ìƒíƒœë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì œ ìµœì¢… ë‚˜ëˆ” ì™„ë£Œ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.`);
                showPage('adminListPage'); 
            } else {
                alert('ì˜ëª»ëœ ìƒíƒœì…ë‹ˆë‹¤. ì‹ ì²­ ì¤‘ì¸ ë¬¼í’ˆë§Œ ìŠ¹ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
            }
        }
        function confirmTrade(itemId) {
            const item = items.find(i => i.id === itemId);
            if (!checkAdminAuth(item, 'trade_action')) {
                alert(`ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ì´ ê±°ë˜ëŠ” ${item.requesterInfo.dept} ê´€ë¦¬ìë§Œ ì™„ë£Œ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
                return;
            }
            // ìƒíƒœ í™•ì¸: ì˜ˆì•½ ìŠ¹ì¸ ìƒíƒœì¼ ë•Œë§Œ ì™„ë£Œ ê°€ëŠ¥
            if (item && item.status === 'ì˜ˆì•½ì¤‘' && item.historyStatus === 'ì˜ˆì•½ ìŠ¹ì¸') { 
                item.status = 'ê±°ë˜ ì™„ë£Œ'; item.historyStatus = 'ê±°ë˜ í™•ì •';
                alert(`${item.name}ì˜ ê±°ë˜ê°€ ìµœì¢… í™•ì •ë˜ì–´ 'ë‚˜ëˆ” ì™„ë£Œ' ìƒíƒœë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`); 
                showPage('adminListPage');
            } else {
                alert('ì˜ëª»ëœ ìƒíƒœì…ë‹ˆë‹¤. ì˜ˆì•½ í™•ì •ëœ ë¬¼í’ˆë§Œ ë‚˜ëˆ” ì™„ë£Œ ì²˜ë¦¬ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
            }
        }
        function approveItem(itemId) {
            const item = items.find(i => i.id === itemId);
            if (!checkAdminAuth(item, 'register_approve')) {
                alert(`ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ì´ ë“±ë¡ì€ ${item.requesterInfo.dept} ê´€ë¦¬ìë§Œ ìŠ¹ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
                return;
            }
            if (item && item.status === 'ìŠ¹ì¸ ëŒ€ê¸°') {
                item.status = 'íŒë§¤ ì¤‘'; 
                alert(`${item.name} ë¬¼í’ˆì´ ëª©ë¡ì— ë“±ë¡(ìŠ¹ì¸)ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                showPage('adminListPage'); 
            }
        }
        function deleteItem(itemId) {
            const item = items.find(i => i.id === itemId);
            // ì‚­ì œ ê¶Œí•œë„ ë“±ë¡ì ë¶€ì„œ ê´€ë¦¬ìì—ê²Œë§Œ ë¶€ì—¬
            if (!checkAdminAuth(item, 'register_approve')) { 
                alert(`ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ì´ ë¬¼í’ˆì€ ${item.requesterInfo.dept} ê´€ë¦¬ìë§Œ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
                return;
            }
            
            if (confirm(`ì •ë§ë¡œ ì´ ë¬¼í’ˆ (${item.name})ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                const index = items.findIndex(i => i.id === itemId);
                if (index > -1) {
                    items.splice(index, 1);
                    // ì‚­ì œ í›„ í˜„ì¬ í˜ì´ì§€ì— ë”°ë¼ ëª©ë¡ì„ ìƒˆë¡œê³ ì¹¨
                    if (document.getElementById('adminListPage').style.display !== 'none') {
                        showPage('adminListPage');
                    } else {
                        showPage('main');
                    }
                }
            }
        }
        function cancelTradeByAdmin(itemId) {
            const item = items.find(i => i.id === itemId);
            if (!checkAdminAuth(item, 'trade_action')) {
                alert(`ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ì´ ê±°ë˜ ì·¨ì†ŒëŠ” ${item.requesterInfo.dept} ê´€ë¦¬ìë§Œ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
                return;
            }

            if (item && item.status === 'ì˜ˆì•½ì¤‘') {
                const action = item.historyStatus === 'ì‹ ì²­ ì¤‘' ? 'ì‹ ì²­ ê±°ì ˆ' : 'ì˜ˆì•½ ì·¨ì†Œ';
                if (confirm(`${item.name}ì— ëŒ€í•œ ${action}ì„ ì§„í–‰í•˜ê³  'ì‹ ì²­ ê°€ëŠ¥' ìƒíƒœë¡œ ë˜ëŒë¦¬ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                    item.historyStatus = 'ì‹ ì²­ ì—†ìŒ'; 
                    item.historyBuyerInfo = null;
                    item.status = 'íŒë§¤ ì¤‘'; 
                    alert(`${item.name}ì˜ ${action}ì´ ì™„ë£Œë˜ê³  'ì‹ ì²­ ê°€ëŠ¥' ìƒíƒœë¡œ ë³µê·€í–ˆìŠµë‹ˆë‹¤.`);
                    showPage('adminListPage'); 
                }
            }
        }
        
        // --- ìˆ˜ì • ê¸°ëŠ¥ (ê´€ë¦¬ì ì „ìš©, ê¶Œí•œ í™•ì¸ ë¡œì§ ì¶”ê°€) ---
        function editItem(itemId) {
            const item = items.find(i => i.id === itemId);
             // ìˆ˜ì • ê¶Œí•œë„ ë“±ë¡ì ë¶€ì„œ ê´€ë¦¬ìì—ê²Œë§Œ ë¶€ì—¬
            if (!checkAdminAuth(item, 'register_approve')) { 
                alert(`ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ì´ ë¬¼í’ˆì€ ${item.requesterInfo.dept} ê´€ë¦¬ìë§Œ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
                return;
            }
            if (!item) return;
            
            const newName = prompt(`[${item.name}]ì˜ ìƒˆ ë¬¼í’ˆ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:`, item.name);
            if (newName === null) return; 
            const newDescription = prompt(`[${item.name}]ì˜ ìƒˆ ìƒì„¸ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”:`, item.description);
            if (newDescription === null) return;

            const newCategory = prompt(`[${item.name}]ì˜ ìƒˆ ì¹´í…Œê³ ë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš” (í˜„ì¬: ${item.category || 'ë¯¸ë¶„ë¥˜'}):`, item.category);
            if (newCategory === null) return;

            const newRName = prompt(`[${item.name}] ë“±ë¡ì ì´ë¦„ (í˜„ì¬: ${item.requesterInfo.name}):`, item.requesterInfo.name);
            if (newRName === null) return;

            // ë¶€ì„œ ì •ë³´ë„ ìˆ˜ì • ê°€ëŠ¥í•˜ê²Œ í•˜ì§€ë§Œ, ëª©ë¡ì— ìˆëŠ” ë¶€ì„œë§Œ í—ˆìš©
            let newRDept = item.requesterInfo.dept;
            let deptPrompt = `[${item.name}] ë“±ë¡ì ë¶€ì„œ (í˜„ì¬: ${item.requesterInfo.dept})\n\nì„ íƒ ê°€ëŠ¥í•œ ë¶€ì„œ: ${departments.join(', ')}\nìƒˆ ë¶€ì„œë¥¼ ì…ë ¥í•˜ì„¸ìš”:`;
            let inputDept = prompt(deptPrompt, item.requesterInfo.dept);

            if (inputDept === null) return;
            if (departments.includes(inputDept.trim())) {
                 newRDept = inputDept.trim();
            } else {
                 alert('ìœ íš¨í•˜ì§€ ì•Šì€ ë¶€ì„œì…ë‹ˆë‹¤. ê¸°ì¡´ ë¶€ì„œê°€ ìœ ì§€ë©ë‹ˆë‹¤.');
            }

            const newRTeam = prompt(`[${item.name}] ë“±ë¡ì íŒ€ (í˜„ì¬: ${item.requesterInfo.team}):`, item.requesterInfo.team);
            if (newRTeam === null) return;
            const newRId = prompt(`[${item.name}] ë“±ë¡ì ê³ ìœ ë²ˆí˜¸ (í˜„ì¬: ${item.requesterInfo.id}):`, item.requesterInfo.id);
            if (newRId === null) return;

            const newImageUrl = prompt(`[${item.name}]ì˜ ìƒˆ ì´ë¯¸ì§€ URLì„ ì…ë ¥í•˜ì„¸ìš” (ë³€ê²½í•˜ì§€ ì•Šìœ¼ë ¤ë©´ ê³µë°±):`, item.imageUrl);
            
            item.name = newName.trim();
            item.description = newDescription.trim();
            item.category = newCategory.trim();
            item.requesterInfo.name = newRName.trim();
            item.requesterInfo.dept = newRDept.trim(); 
            item.requesterInfo.team = newRTeam.trim();
            item.requesterInfo.id = newRId.trim();

            if (newImageUrl !== null && newImageUrl.trim() !== "") { item.imageUrl = newImageUrl.trim(); }

            alert(`ë¬¼í’ˆ [${item.id}]ì˜ ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤. (ê´€ë¦¬ ë¶€ì„œ: ${item.requesterInfo.dept})`);
            showPage('main');
        }
        
    </script>
</body>
</html>